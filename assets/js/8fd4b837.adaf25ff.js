"use strict";(self.webpackChunkproject_website=self.webpackChunkproject_website||[]).push([[6121],{25443:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>h,frontMatter:()=>a,metadata:()=>t,toc:()=>d});var t=o(71806),s=o(74848),r=o(28453);const a={},i="Layouts",l={},d=[{value:"When to build a custom layout",id:"when-to-build-a-custom-layout",level:2},{value:"Tutorial: build a layout from scratch",id:"tutorial-build-a-layout-from-scratch",level:2},{value:"1. Extend <code>GraphLayout</code>",id:"1-extend-graphlayout",level:3},{value:"2. Respond to graph lifecycle hooks",id:"2-respond-to-graph-lifecycle-hooks",level:3},{value:"3. Emit lifecycle events",id:"3-emit-lifecycle-events",level:3},{value:"4. Publish node and edge geometry",id:"4-publish-node-and-edge-geometry",level:3},{value:"5. Handle user interactions",id:"5-handle-user-interactions",level:3},{value:"6. Wire the layout into <code>GraphLayer</code>",id:"6-wire-the-layout-into-graphlayer",level:3},{value:"Recommended testing",id:"recommended-testing",level:2},{value:"Further reading",id:"further-reading",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"layouts",children:"Layouts"})}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"@deck.gl-community/graph-layers"})," package ships a handful of layouts, but every application eventually needs custom geometry or physics. This guide walks through the lifecycle of a layout and shows how to build, test, and ship your own implementation."]}),"\n",(0,s.jsx)(n.h2,{id:"when-to-build-a-custom-layout",children:"When to build a custom layout"}),"\n",(0,s.jsx)(n.p,{children:"Use a bespoke layout when any of the following are true:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"You have domain-specific rules (hierarchies, timelines, geographic projections) that the stock layouts cannot express."}),"\n",(0,s.jsxs)(n.li,{children:["You need to integrate an existing solver or physics engine and expose its parameters through ",(0,s.jsx)(n.code,{children:"GraphLayer"})," props."]}),"\n",(0,s.jsx)(n.li,{children:"You want to preprocess server-side coordinates (e.g. a recommendation engine) and simply stream them into the client."}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["Before writing code, review the ",(0,s.jsxs)(n.a,{href:"/deck.gl-community/docs/modules/graph-layers/api-reference/layouts/graph-layout",children:[(0,s.jsx)(n.code,{children:"GraphLayout"})," API reference"]})," to understand the contract between the layout and ",(0,s.jsx)(n.code,{children:"GraphLayer"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"tutorial-build-a-layout-from-scratch",children:"Tutorial: build a layout from scratch"}),"\n",(0,s.jsxs)(n.p,{children:["The snippets below sketch a ",(0,s.jsx)(n.code,{children:"SpiralLayout"})," that spreads nodes along a spiral arm. Each section focuses on one part of the ",(0,s.jsx)(n.a,{href:"/deck.gl-community/docs/modules/graph-layers/api-reference/layouts/graph-layout",children:(0,s.jsx)(n.code,{children:"GraphLayout"})})," lifecycle."]}),"\n",(0,s.jsxs)(n.h3,{id:"1-extend-graphlayout",children:["1. Extend ",(0,s.jsx)(n.code,{children:"GraphLayout"})]}),"\n",(0,s.jsxs)(n.p,{children:["Create a class that extends ",(0,s.jsx)(n.code,{children:"GraphLayout"})," (optionally passing a props interface) and seed internal state you will reuse across lifecycle calls."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"import {GraphLayout, GraphLayoutProps} from '@deck.gl-community/graph-layers';\n\nexport type SpiralLayoutProps = GraphLayoutProps & {\n  radiusStep?: number;\n  angleStep?: number;\n};\n\nexport class SpiralLayout extends GraphLayout<SpiralLayoutProps> {\n  get [Symbol.toStringTag]() {\n    return 'SpiralLayout';\n  }\n\n  static defaultProps: Required<SpiralLayoutProps> = {\n    ...GraphLayout.defaultProps,\n    radiusStep: 20,\n    angleStep: Math.PI / 6\n  };\n\n  constructor(props: SpiralLayoutProps = {}) {\n    super(props, SpiralLayout.defaultProps);\n    this._nodePositions = new Map();\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"2-respond-to-graph-lifecycle-hooks",children:"2. Respond to graph lifecycle hooks"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"GraphLayer"})," feeds data into your layout via ",(0,s.jsx)(n.code,{children:"initializeGraph"})," (first load) and ",(0,s.jsx)(n.code,{children:"updateGraph"})," (incremental updates). Cache any graph references you need and make sure ",(0,s.jsx)(n.code,{children:"updateGraph"})," works even when the topology changes."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"initializeGraph(graph) {\n  this._graph = graph;\n  this._nodePositions.clear();\n}\n\nupdateGraph(graph) {\n  this._graph = graph;\n  for (const node of graph.getNodes()) {\n    if (!this._nodePositions.has(node.getId())) {\n      this._nodePositions.set(node.getId(), null);\n    }\n  }\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"GraphLayout"})," base class exposes ",(0,s.jsx)(n.code,{children:"_updateBounds()"})," and ",(0,s.jsx)(n.code,{children:"_calculateBounds()"})," helpers. Override ",(0,s.jsx)(n.code,{children:"_updateBounds"})," when your layout derives bounds that differ from the raw node positions (for example, when padding edges or projecting coordinates)."]}),"\n",(0,s.jsx)(n.h3,{id:"3-emit-lifecycle-events",children:"3. Emit lifecycle events"}),"\n",(0,s.jsxs)(n.p,{children:["Call ",(0,s.jsx)(n.code,{children:"_onLayoutStart"}),", ",(0,s.jsx)(n.code,{children:"_onLayoutChange"}),", and ",(0,s.jsx)(n.code,{children:"_onLayoutDone"})," during your computations. These hooks notify React components, power loading indicators, and keep ",(0,s.jsx)(n.a,{href:"/deck.gl-community/docs/modules/graph-layers/api-reference/layouts/graph-layout#the-layout-lifecycle",children:(0,s.jsx)(n.code,{children:"GraphLayoutEventDetail"})})," data in sync."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"start() {\n  if (!this._graph) {\n    return;\n  }\n  this.state = 'start';\n  this._onLayoutStart();\n\n  const positions = [];\n  let index = 0;\n  for (const node of this._graph.getNodes()) {\n    const radius = this.props.radiusStep * (index + 1);\n    const angle = this.props.angleStep * index++;\n    const nextPosition = [Math.cos(angle) * radius, Math.sin(angle) * radius];\n    this._nodePositions.set(node.getId(), nextPosition);\n    positions.push(nextPosition);\n  }\n\n  this._bounds = this._calculateBounds(positions);\n  this.state = 'done';\n  this._onLayoutChange();\n  this._onLayoutDone();\n}\n\nupdate() {\n  // For this deterministic layout, recomputing is identical to start().\n  this.start();\n}\n\nstop() {\n  this.state = 'done';\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["For long-running solvers (such as force-directed layouts), call ",(0,s.jsx)(n.code,{children:"_onLayoutChange"})," inside your simulation loop so the view can animate."]}),"\n",(0,s.jsx)(n.h3,{id:"4-publish-node-and-edge-geometry",children:"4. Publish node and edge geometry"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"GraphLayer"})," queries positions every render. Implement ",(0,s.jsx)(n.code,{children:"getNodePosition"})," and ",(0,s.jsx)(n.code,{children:"getEdgePosition"})," so they return finite coordinates when available."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"getNodePosition(node) {\n  return this._nodePositions.get(node.getId()) ?? null;\n}\n\ngetEdgePosition(edge) {\n  const source = this.getNodePosition(edge.getSourceNode());\n  const target = this.getNodePosition(edge.getTargetNode());\n  if (!source || !target) {\n    return null;\n  }\n  return {\n    type: 'line',\n    sourcePosition: source,\n    targetPosition: target,\n    controlPoints: []\n  };\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["When returning ",(0,s.jsx)(n.code,{children:"null"}),", the layer hides unfinished primitives, allowing incremental solvers to display partial results without jitter."]}),"\n",(0,s.jsx)(n.h3,{id:"5-handle-user-interactions",children:"5. Handle user interactions"}),"\n",(0,s.jsx)(n.p,{children:"If your UI supports drag-and-drop, override the interaction hooks:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"lockNodePosition(node, x, y) {\n  this._nodePositions.set(node.getId(), [x, y]);\n}\n\nunlockNodePosition(node) {\n  this._nodePositions.delete(node.getId());\n}\n\nresume() {\n  // Restart your solver here (e.g. re-enable a physics simulation).\n  this.start();\n}\n"})}),"\n",(0,s.jsxs)(n.h3,{id:"6-wire-the-layout-into-graphlayer",children:["6. Wire the layout into ",(0,s.jsx)(n.code,{children:"GraphLayer"})]}),"\n",(0,s.jsxs)(n.p,{children:["Finally, instantiate your layout and pass it to ",(0,s.jsx)(n.code,{children:"GraphLayer"}),". You can hot-swap layouts by comparing instances with ",(0,s.jsx)(n.code,{children:"layout.equals"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-jsx",children:"import {GraphLayer} from '@deck.gl-community/graph-layers';\nimport {SpiralLayout} from './spiral-layout';\n\nconst layout = new SpiralLayout({radiusStep: 30});\n\n<GraphLayer\n  id=\"spiral-graph\"\n  graph={graph}\n  layout={layout}\n  enableDragging\n/>;\n"})}),"\n",(0,s.jsx)(n.h2,{id:"recommended-testing",children:"Recommended testing"}),"\n",(0,s.jsx)(n.p,{children:"Robust layouts lean on automated tests so regressions do not slip in as the ecosystem evolves."}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Unit-test deterministic positioning."})," Instantiate your layout with a fixture ",(0,s.jsx)(n.code,{children:"ClassicGraph"})," and assert that ",(0,s.jsx)(n.code,{children:"getNodePosition"})," returns finite coordinates and that ",(0,s.jsx)(n.code,{children:"_bounds"})," reflects the expected extent.","\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"import {ClassicGraph} from '@deck.gl-community/graph-layers';\nimport {describe, expect, it} from 'vitest';\nimport {SpiralLayout} from '../spiral-layout';\n\ndescribe('SpiralLayout', () => {\n  it('computes stable positions', () => {\n    const graph = new ClassicGraph({\n      nodes: [{id: 'a'}, {id: 'b'}],\n      edges: []\n    });\n    const layout = new SpiralLayout();\n    layout.initializeGraph(graph);\n    layout.start();\n    expect(layout.getNodePosition(graph.getNode('a'))).toBeTruthy();\n    expect(layout.getBounds()).not.toBeNull();\n  });\n});\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Simulate lifecycle events."})," Stub ",(0,s.jsx)(n.code,{children:"onLayoutStart"})," / ",(0,s.jsx)(n.code,{children:"onLayoutDone"})," props and confirm they fire in the right order when ",(0,s.jsx)(n.code,{children:"start"})," or ",(0,s.jsx)(n.code,{children:"update"})," runs."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Exercise drag helpers."})," When you expose dragging, verify ",(0,s.jsx)(n.code,{children:"lockNodePosition"}),", ",(0,s.jsx)(n.code,{children:"unlockNodePosition"}),", and ",(0,s.jsx)(n.code,{children:"resume"})," interact correctly with your solver."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Run the repo test suite"})," (",(0,s.jsx)(n.code,{children:"yarn test-node"}),") before publishing so the shared CI harness validates your changes."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"further-reading",children:"Further reading"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsxs)(n.a,{href:"/deck.gl-community/docs/modules/graph-layers/api-reference/layouts/graph-layout",children:[(0,s.jsx)(n.code,{children:"GraphLayout"})," API reference"]})}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsxs)(n.a,{href:"/deck.gl-community/docs/modules/graph-layers/api-reference/layouts/simple-layout",children:[(0,s.jsx)(n.code,{children:"SimpleLayout"})," API reference"]})," and ",(0,s.jsx)(n.a,{href:"https://github.com/visgl/deck.gl-community/blob/main/modules/graph-layers/src/layouts/simple-layout.ts",children:"source code"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsxs)(n.a,{href:"/deck.gl-community/docs/modules/graph-layers/api-reference/layouts/d3-force-layout",children:[(0,s.jsx)(n.code,{children:"D3ForceLayout"})," API reference"]})," and ",(0,s.jsx)(n.a,{href:"https://github.com/visgl/deck.gl-community/blob/main/modules/graph-layers/src/layouts/d3-force/d3-force-layout.ts",children:"source code"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsxs)(n.a,{href:"/deck.gl-community/docs/modules/graph-layers/api-reference/layers/graph-layer",children:[(0,s.jsx)(n.code,{children:"GraphLayer"})," API reference"]})," for integration details"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},28453:(e,n,o)=>{o.d(n,{R:()=>a,x:()=>i});var t=o(96540);const s={},r=t.createContext(s);function a(e){const n=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),t.createElement(r.Provider,{value:n},e.children)}},71806:e=>{e.exports=JSON.parse('{"id":"modules/graph-layers/developer-guide/layouts","title":"Layouts","description":"The @deck.gl-community/graph-layers package ships a handful of layouts, but every application eventually needs custom geometry or physics. This guide walks through the lifecycle of a layout and shows how to build, test, and ship your own implementation.","source":"@site/../docs/modules/graph-layers/developer-guide/layouts.md","sourceDirName":"modules/graph-layers/developer-guide","slug":"/modules/graph-layers/developer-guide/layouts","permalink":"/deck.gl-community/docs/modules/graph-layers/developer-guide/layouts","draft":false,"unlisted":false,"editUrl":"https://github.com/visgl/deck.gl-community/tree/master/website/../docs/modules/graph-layers/developer-guide/layouts.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"layout-animation","permalink":"/deck.gl-community/docs/modules/graph-layers/developer-guide/layout-animation"},"next":{"title":"Graph Interface","permalink":"/deck.gl-community/docs/modules/graph-layers/api-reference/graph"}}')}}]);