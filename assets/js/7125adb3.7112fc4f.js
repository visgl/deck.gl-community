"use strict";(self.webpackChunkproject_website=self.webpackChunkproject_website||[]).push([[4598],{4641:(e,r,o)=>{o.r(r),o.d(r,{assets:()=>c,contentTitle:()=>n,default:()=>h,frontMatter:()=>s,metadata:()=>l,toc:()=>i});var t=o(4848),a=o(8453);const s={},n="Get Started",l={id:"modules/arrow-layers/developer-guide/get-started",title:"Get Started",description:"Providing accessors",source:"@site/../docs/modules/arrow-layers/developer-guide/get-started.md",sourceDirName:"modules/arrow-layers/developer-guide",slug:"/modules/arrow-layers/developer-guide/get-started",permalink:"/deck.gl-community/docs/modules/arrow-layers/developer-guide/get-started",draft:!1,unlisted:!1,editUrl:"https://github.com/visgl/deck.gl-community/tree/master/website/../docs/modules/arrow-layers/developer-guide/get-started.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Overview",permalink:"/deck.gl-community/docs/modules/arrow-layers/"},next:{title:"Layers",permalink:"/deck.gl-community/docs/modules/arrow-layers/api-reference/layers"}},c={},i=[{value:"Providing accessors",id:"providing-accessors",level:2},{value:"Pre-computed Arrow columns",id:"pre-computed-arrow-columns",level:3},{value:"Function accessors",id:"function-accessors",level:3},{value:"Data Loading",id:"data-loading",level:2},{value:"Arrow IPC",id:"arrow-ipc",level:3},{value:"Parquet",id:"parquet",level:3},{value:"GeoParquet",id:"geoparquet",level:3},{value:"FlatGeobuf",id:"flatgeobuf",level:3}];function d(e){const r={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",p:"p",pre:"pre",strong:"strong",...(0,a.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.h1,{id:"get-started",children:"Get Started"}),"\n",(0,t.jsx)(r.h2,{id:"providing-accessors",children:"Providing accessors"}),"\n",(0,t.jsxs)(r.p,{children:["All deck.gl layers have two types of properties: ",(0,t.jsx)(r.a,{href:"https://deck.gl/docs/api-reference/layers/scatterplot-layer#render-options",children:'"Render Options"'}),' \u2014 constant properties across a layer \u2014 and "Data Accessors" \u2014 properties that can vary across rows. An accessor is any property prefixed with ',(0,t.jsx)(r.code,{children:"get"}),", like ",(0,t.jsx)(r.code,{children:"GeoArrowScatterplotLayer"}),"'s ",(0,t.jsx)(r.code,{children:"getFillColor"}),"."]}),"\n",(0,t.jsxs)(r.p,{children:["With ",(0,t.jsx)(r.code,{children:"@deck.gl-community/arrow-layers"})," specifically, there are two ways to pass these data accessors, either as pre-computed columns or with function callbacks on Arrow data."]}),"\n",(0,t.jsx)(r.h3,{id:"pre-computed-arrow-columns",children:"Pre-computed Arrow columns"}),"\n",(0,t.jsxs)(r.p,{children:["If you have an Arrow column (",(0,t.jsx)(r.a,{href:"https://arrow.apache.org/docs/js/classes/Arrow_dom.Vector.html",children:(0,t.jsx)(r.code,{children:"Vector"})})," in Arrow JS terminology), you can pass that directly into a layer:"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ts",children:'import { Table } from "apache-arrow";\nimport { GeoArrowScatterplotLayer } from "@deck.gl-community/arrow-layers";\n\nconst table = new Table(...);\nconst deckLayer = new GeoArrowScatterplotLayer({\n  id: "scatterplot",\n  data: table,\n  /// Geometry column\n  getPosition: table.getChild("geometry")!,\n  /// Column of type FixedSizeList[3] or FixedSizeList[4], with child type Uint8\n  getFillColor: table.getChild("colors")!,\n});\n'})}),"\n",(0,t.jsxs)(r.p,{children:["For example, ",(0,t.jsx)(r.a,{href:"https://github.com/developmentseed/lonboard",children:"lonboard"})," computes Arrow columns on the Python side for all attributes so that end users have available the full capabilities Python. Then those columns are serialized to Python and the resulting ",(0,t.jsx)(r.code,{children:"arrow.Vector"})," is passed into the relevant layer."]}),"\n",(0,t.jsx)(r.h3,{id:"function-accessors",children:"Function accessors"}),"\n",(0,t.jsxs)(r.p,{children:["GeoArrow layers accept a callback that takes an object with ",(0,t.jsx)(r.code,{children:"index"})," and ",(0,t.jsx)(r.code,{children:"data"}),". ",(0,t.jsx)(r.code,{children:"data"})," is an ",(0,t.jsx)(r.code,{children:"arrow.RecordBatch"})," object (a vertical section of the input ",(0,t.jsx)(r.code,{children:"Table"}),"), and ",(0,t.jsx)(r.code,{children:"index"})," is the positional index of the current row of that batch. In TypeScript, you should see accurate type checking."]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ts",children:'const deckLayer = new GeoArrowPathLayer({\n  id: "geoarrow-path",\n  data: table,\n  getColor: ({ index, data, target }) => {\n    const recordBatch = data.data;\n    const row = recordBatch.get(index)!;\n    return COLORS_LOOKUP[row["scalerank"]];\n  },\n}),\n'})}),"\n",(0,t.jsxs)(r.p,{children:["The full example is in ",(0,t.jsx)(r.code,{children:"examples/multilinestring/app.tsx"}),"."]}),"\n",(0,t.jsxs)(r.p,{children:["You can also use assign to the ",(0,t.jsx)(r.code,{children:"target"})," prop to reduce garbage collector overhead, as described in the ",(0,t.jsx)(r.a,{href:"https://deck.gl/docs/developer-guide/performance#supply-binary-blobs-to-the-data-prop",children:"deck.gl performance guide"}),"."]}),"\n",(0,t.jsx)(r.h2,{id:"data-loading",children:"Data Loading"}),"\n",(0,t.jsx)(r.p,{children:"To create deck.gl layers using this library, you need to first get GeoArrow-formatted data into the browser, discussed below."}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.a,{href:"https://gdal.org/",children:"OGR/GDAL"})," is useful for converting among data formats on the backend, and it includes both ",(0,t.jsx)(r.a,{href:"https://gdal.org/drivers/vector/arrow.html#vector-arrow",children:"GeoArrow"})," and ",(0,t.jsx)(r.a,{href:"https://gdal.org/drivers/vector/parquet.html",children:"GeoParquet"})," drivers. Pass ",(0,t.jsx)(r.code,{children:"-lco GEOMETRY_ENCODING=GEOARROW"})," when converting to Arrow or Parquet files in order to store geometries in a GeoArrow-native geometry column."]}),"\n",(0,t.jsx)(r.h3,{id:"arrow-ipc",children:"Arrow IPC"}),"\n",(0,t.jsxs)(r.p,{children:["If you already have Arrow IPC files (also called Feather files) with a GeoArrow geometry column, you can use ",(0,t.jsx)(r.a,{href:"https://www.npmjs.com/package/apache-arrow",children:(0,t.jsx)(r.code,{children:"apache-arrow"})})," to load those files."]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ts",children:'import { tableFromIPC } from "apache-arrow";\nimport { GeoArrowScatterplotLayer } from "@deck.gl-community/arrow-layers";\n\nconst resp = await fetch("url/to/file.arrow");\nconst jsTable = await tableFromIPC(resp);\nconst deckLayer = new GeoArrowScatterplotLayer({\n  id: "scatterplot",\n  data: jsTable,\n  /// Replace with the correct geometry column name\n  getPosition: jsTable.getChild("geometry")!,\n});\n'})}),"\n",(0,t.jsxs)(r.p,{children:["Note those IPC files must be saved ",(0,t.jsx)(r.strong,{children:"uncompressed"})," (at least not internally compressed). As of v14, Arrow JS does not currently support loading IPC files with internal compression."]}),"\n",(0,t.jsx)(r.h3,{id:"parquet",children:"Parquet"}),"\n",(0,t.jsxs)(r.p,{children:["If you have a Parquet file where the geometry column is stored as ",(0,t.jsx)(r.em,{children:"GeoArrow"})," encoding (i.e. not as a binary column with WKB-encoded geometries), you can use the stable ",(0,t.jsx)(r.code,{children:"parquet-wasm"})," library to load those files."]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ts",children:'import { readParquet } from "parquet-wasm"\nimport { tableFromIPC } from "apache-arrow";\nimport { GeoArrowScatterplotLayer } from "@deck.gl-community/arrow-layers";\n\nconst resp = await fetch("url/to/file.parquet");\nconst arrayBuffer = await resp.arrayBuffer();\nconst wasmTable = readParquet(new Uint8Array(arrayBuffer));\nconst jsTable = tableFromIPC(wasmTable.intoIPCStream());\nconst deckLayer = new GeoArrowScatterplotLayer({\n  id: "scatterplot",\n  data: jsTable,\n  /// Replace with the correct geometry column name\n  getPosition: jsTable.getChild("geometry")!,\n});\n'})}),"\n",(0,t.jsxs)(r.p,{children:["See below for instructions to load GeoParquet 1.0 files, which have WKB-encoded geometries that need to be decoded before they can be used with ",(0,t.jsx)(r.code,{children:"@deck.gl-community/arrow-layers"}),"."]}),"\n",(0,t.jsx)(r.h3,{id:"geoparquet",children:"GeoParquet"}),"\n",(0,t.jsxs)(r.p,{children:["An initial version of the ",(0,t.jsx)(r.a,{href:"https://www.npmjs.com/package/@geoarrow/geoparquet-wasm",children:(0,t.jsx)(r.code,{children:"@geoarrow/geoparquet-wasm"})})," library is published, which reads a GeoParquet file to GeoArrow memory."]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ts",children:'import { readGeoParquet } from "@geoarrow/geoparquet-wasm";\nimport { tableFromIPC } from "apache-arrow";\nimport { GeoArrowScatterplotLayer } from "@deck.gl-community/arrow-layers";\n\nconst resp = await fetch("url/to/file.parquet");\nconst arrayBuffer = await resp.arrayBuffer();\nconst wasmTable = readGeoParquet(new Uint8Array(arrayBuffer));\nconst jsTable = tableFromIPC(wasmTable.intoTable().intoIPCStream());\nconst deckLayer = new GeoArrowScatterplotLayer({\n  id: "scatterplot",\n  data: jsTable,\n  /// Replace with the correct geometry column name\n  getPosition: jsTable.getChild("geometry")!,\n});\n'})}),"\n",(0,t.jsxs)(r.p,{children:["If you hit a bug with ",(0,t.jsx)(r.code,{children:"@geoarrow/geoparquet-wasm"}),", please create a reproducible bug report ",(0,t.jsx)(r.a,{href:"https://github.com/geoarrow/geoarrow-rs/issues/new",children:"here"}),"."]}),"\n",(0,t.jsx)(r.h3,{id:"flatgeobuf",children:"FlatGeobuf"}),"\n",(0,t.jsxs)(r.p,{children:["An initial version of the ",(0,t.jsx)(r.a,{href:"https://www.npmjs.com/package/@geoarrow/flatgeobuf-wasm",children:(0,t.jsx)(r.code,{children:"@geoarrow/flatgeobuf-wasm"})})," library is published, which reads a FlatGeobuf file to GeoArrow memory. As of version 0.2.0-beta.1, this library does not yet support remote files, and expects the full FlatGeobuf file to exist in memory."]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ts",children:'import { readFlatGeobuf } from "@geoarrow/flatgeobuf-wasm";\nimport { tableFromIPC } from "apache-arrow";\nimport { GeoArrowScatterplotLayer } from "@deck.gl-community/arrow-layers";\n\nconst resp = await fetch("url/to/file.fgb");\nconst arrayBuffer = await resp.arrayBuffer();\nconst wasmTable = readFlatGeobuf(new Uint8Array(arrayBuffer));\nconst jsTable = tableFromIPC(wasmTable.intoTable().intoIPCStream());\nconst deckLayer = new GeoArrowScatterplotLayer({\n  id: "scatterplot",\n  data: jsTable,\n  /// Replace with the correct geometry column name\n  getPosition: jsTable.getChild("geometry")!,\n});\n'})}),"\n",(0,t.jsxs)(r.p,{children:["If you hit a bug with ",(0,t.jsx)(r.code,{children:"@geoarrow/flatgeobuf-wasm"}),", please create a reproducible bug report ",(0,t.jsx)(r.a,{href:"https://github.com/geoarrow/geoarrow-rs/issues/new",children:"here"}),"."]})]})}function h(e={}){const{wrapper:r}={...(0,a.R)(),...e.components};return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453:(e,r,o)=>{o.d(r,{R:()=>n,x:()=>l});var t=o(6540);const a={},s=t.createContext(a);function n(e){const r=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function l(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:n(e.components),t.createElement(s.Provider,{value:r},e.children)}}}]);