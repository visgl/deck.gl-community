"use strict";(self.webpackChunkproject_website=self.webpackChunkproject_website||[]).push([[7061],{340:(e,t,i)=>{i.d(t,{Vi:()=>n,lP:()=>o});const n={LIGHT:"https://deck.gl/mapstyle/deck-light.json",LIGHT_LABEL:"https://basemaps.cartocdn.com/gl/positron-gl-style/style.json",DARK:"https://deck.gl/mapstyle/deck-dark.json",BLANK:{version:8,sources:{},layers:[]}},o="https://github.com/visgl/deck.gl-community/tree/master"},4451:(e,t,i)=>{i.d(t,{Ys:()=>G,ww:()=>X,xv:()=>_});var n=i(6540),o=i(3724);const s=e=>"@media screen and (max-width: 480px)",r=o.Ay.div.withConfig({displayName:"styled__PanelContainer",componentId:"sc-oqnqzc-0"})(["font-size:14px;position:absolute;top:0;right:0;width:344px;background:var(--ifm-background-surface-color);box-shadow:var(--ifm-global-shadow-lw);margin:24px;padding:10px 24px;max-height:96%;overflow-x:hidden;overflow-y:auto;overflow-y:overlay;outline:none;z-index:1;","{width:auto;left:0;}"],s),a=o.Ay.div.withConfig({displayName:"styled__PanelExpander",componentId:"sc-oqnqzc-1"})(["display:none;width:16px;height:16px;font-family:serif;font-size:0.8em;text-align:center;line-height:16px;border-radius:50%;background:",";color:",";","{display:block;}"],e=>e.$expanded?"none":"var(--ifm-color-gray-900)",e=>e.$expanded?"var(--ifm-color-black)":"var(--ifm-color-white)",s),l=o.Ay.div.withConfig({displayName:"styled__PanelTitle",componentId:"sc-oqnqzc-2"})(["display:flex;align-items:center;justify-content:space-between;font:bold 1.25em var(--ifm-font-family-base);margin:8px 0;","{cursor:pointer;}"],s),d=o.Ay.div.withConfig({displayName:"styled__PanelContent",componentId:"sc-oqnqzc-3"})(["div > *{vertical-align:middle;white-space:nowrap;}div > label{display:inline-block;width:40%;margin-right:10%;color:var(--ifm-color-content-secondary);margin-top:2px;margin-bottom:2px;}div > input,div > a,div > button,div > select{font:normal 11px/16px var(--ifm-font-family-base);line-height:20px;text-transform:none;text-overflow:ellipsis;overflow:hidden;display:inline-block;padding:0 4px;width:50%;height:20px;text-align:left;}div > button{color:initial;}div > button:disabled{color:var(--ifm-color-gray-300);cursor:default;background:var(--ifm-color-gray-300);}div > input{border:solid 1px var(--ifm-color-gray-300);&:disabled{background:var(--ifm-color-white);}&[type='checkbox']{height:auto;}}p{margin-bottom:12px;white-space:initial;}","{display:",";}"],s,e=>e.$expanded?"block":"none"),c=o.Ay.a.withConfig({displayName:"styled__SourceLink",componentId:"sc-oqnqzc-4"})(["display:block;text-align:right;margin-top:8px;font:bold 12px/20px var(--ifm-font-family-base);color:var(--ifm-color-content-secondary);","{display:",";}"],s,e=>e.$expanded?"block":"none");var p=i(8587),h=i(4848);const g=["name","onChange","displayName","altValue","displayValue"],u=o.Ay.div.withConfig({displayName:"input__InputContainer",componentId:"sc-1myx0c6-0"})(["position:relative;width:100%;&:last-child{margin-bottom:20px;}> *{vertical-align:middle;white-space:nowrap;}label{display:inline-block;width:40%;margin-right:10%;margin-top:2px;margin-bottom:2px;}input,a,button{background:var(--ifm-background-surface-color);font-size:0.9em;text-transform:none;text-overflow:ellipsis;overflow:hidden;display:inline-block;padding:0 4px;margin:0;width:50%;height:20px;line-height:1.833;text-align:left;}button{color:initial;}button:disabled{color:var(--ifm-color-gray-500);cursor:default;background:var(--ifm-color-gray-300);}input{border:solid 1px var(--ifm-color-gray-500);&:disabled{background:var(--ifm-color-gray-300);}&[type='checkbox']{height:auto;}}.tooltip{left:50%;top:24px;opacity:0;pointer-events:none;transition:opacity 200ms;}&:hover .tooltip{opacity:1;}"]);function m(e){let{name:t,min:i,max:o,step:s,displayName:r,displayValue:a,onChange:l}=e;const d=(0,n.useCallback)(e=>{const{value:n}=e.target;let s=Number(n);void 0!==i&&(s=Math.max(i,s)),void 0!==o&&(s=Math.min(o,s)),l(t,s)},[i,o,l]);return(0,h.jsxs)(u,{children:[(0,h.jsx)("label",{children:r}),(0,h.jsxs)("div",{className:"tooltip",children:[r,": ",String(a)]}),(0,h.jsx)("input",{type:"range",min:i,max:o,value:a,step:s,onChange:d})]})}function f(e){let{name:t,value:i,displayName:o,displayValue:s,onChange:r}=e;const a=(0,n.useCallback)(e=>{const i=e.target.checked;r(t,i)},[r]);return(0,h.jsxs)(u,{children:[(0,h.jsx)("label",{children:o}),(0,h.jsxs)("div",{className:"tooltip",children:[o,": ",String(s)]}),(0,h.jsx)("input",{type:"checkbox",checked:i,onChange:a})]})}function y(e){const{name:t,onChange:i,displayName:o,altValue:s,displayValue:r}=e,a=(0,p.A)(e,g),l=(0,n.useCallback)(e=>{i(t,e.target.value)},[i]),d=(0,n.useCallback)(()=>{i(t,s)},[s,i]),c=a;switch(e.type){case"link":return(0,h.jsxs)(u,{children:[(0,h.jsx)("label",{children:o}),(0,h.jsx)("a",{href:r,target:"_new",children:r})]});case"function":case"json":const t=Boolean(s);return(0,h.jsxs)(u,{children:[(0,h.jsx)("label",{children:o}),(0,h.jsx)("button",{type:"text",disabled:!t,onClick:d,children:r})]});case"select":return(0,h.jsxs)(u,{children:[(0,h.jsx)("label",{children:o}),(0,h.jsx)("select",{onChange:l,value:r,children:e.options.map((e,t)=>(0,h.jsx)("option",{value:e,children:e},t))})]});case"checkbox":return(0,h.jsx)(f,Object.assign({},e));case"range":return(0,h.jsx)(m,Object.assign({},e));default:return(0,h.jsxs)(u,{children:[(0,h.jsx)("label",{children:o}),(0,h.jsxs)("div",{className:"tooltip",children:[o,": ",String(r)]}),(0,h.jsx)("input",Object.assign({},c,{value:r,onChange:l}))]})}}const x=o.Ay.div.withConfig({displayName:"spinner__SpinnerContainer",componentId:"sc-ok6n2c-0"})(["height:18px;line-height:18px;font-size:10px;> div{white-space:nowrap;left:0;bottom:0;position:absolute;height:18px;padding-left:20px;transition:width 0.5s;}.spinner--fill{background:$primary;color:$white;overflow:hidden;}.spinner--text{color:$black-40;}&.done{height:0 !important;line-height:0;font-size:0;transition:height 0.5s 1s;> div{height:0 !important;transition:height 0.5s 1s;}}"]);function C(e){let{meta:t}=e;if(!Number.isFinite(t.progress)&&!Number.isFinite(t.progressAlt))return null;const i=(t.progress||0)+(t.progressAlt||0),n=Math.round(1e3*i)/10,o="Loading... "+n+"%";return(0,h.jsxs)(x,{className:i>=1?"done":"",children:[(0,h.jsx)("div",{className:"spinner--text",children:o}),(0,h.jsx)("div",{className:"spinner--fill",style:{width:n+"%"},children:o})]})}const v=o.Ay.div.withConfig({displayName:"info-panel__InfoPanelContent",componentId:"sc-1qy2onu-0"})(["hr{margin:12px -24px;}a{text-decoration:none;display:inline;color:var(--ifm-color-primary);}p{margin-bottom:16px;}.legend{display:inline-block;width:12px;height:12px;}.stat{text-transform:uppercase;font-size:0.833em;b{display:block;font-size:3em;font-weight:bold;line-height:1.833;}}hr{border:none;background:var(--ifm-color-gray-400);height:1px;}.layout{display:table;width:100%;> *{display:table-cell !important;}.col-1-3{width:33.33%;}.col-1-2{width:50%;}.text-right{text-align:right;}.text-center{text-align:center;}}"]);function b(e){let{title:t,children:i,sourceLink:o}=e;const[s,p]=(0,n.useState)(!1);return(0,h.jsxs)(r,{children:[(0,h.jsxs)(l,{onClick:()=>p(!s),children:[(0,h.jsx)("div",{children:t}),(0,h.jsx)(a,{$expanded:s,children:s?"\u2715":"i"})]}),(0,h.jsx)(d,{$expanded:s,children:i}),(0,h.jsx)(c,{$expanded:s,href:o,target:"_new",children:"View Code \u2197"})]})}function P(e){let{title:t,sourceLink:i,params:n,meta:o,children:s,updateParam:r}=e;return(0,h.jsxs)(b,{title:t,sourceLink:i,children:[(0,h.jsxs)(v,{children:[s,Object.keys(n).length>0&&(0,h.jsx)("hr",{}),Object.keys(n).sort().map((e,t)=>(0,h.jsx)(y,Object.assign({name:e},n[e],{onChange:r}),t+"-"+e))]}),(0,h.jsx)(C,{meta:o})]})}var S=i(9228);const w={};function k(e,t){let i=0;w[e]&&w[e].terminate();const n=new Worker(e);w[e]=n;let o=[];n.onmessage=e=>{const{action:i,data:s,meta:r}=e.data;"end"===i?n.terminate():"add"===i&&s&&s.length&&(o=o.concat(s),t(o,r))},this.onProgress=e=>{const{responseText:t}=e.target,o=t.lastIndexOf("\n")+1;n.postMessage({event:"progress",text:t.slice(i,o)}),i=o},this.onLoad=e=>{const{responseText:t}=e;n.postMessage({event:"load",text:t.slice(i)})}}function A(e,t,i){if(t){const n=(0,S.Em)(e),o=new k(t,(e,t)=>{i(e,t)});n.on("progress",o.onProgress).on("load",o.onLoad).get()}else/\.(json|geojson)$/.test(e)?(0,S.Pq)(e,(e,t)=>{e||i(t,{})}):(0,S.Qq)(e,(e,t)=>{e||i(t,{})})}function j(e,t){return t.match(/^\w+:\/\//)?t:e.replace(/\/$/,"")+"/"+t.replace(/^\//,"")}var M=i(6420);const F=e=>{if("function"===e.type){let t=String(e.value);if(Array.isArray(e.value)&&(t="["+t+"]"),"function"==typeof e.value)return t=t.replace(/^function (\w+)?\((\w*?)\)/,"$2 =>"),t=t.replace(/^function (\w+)?(\(.*?\))/,"$2 =>"),t=t.replace(/\{\s*return\s*(.*?);?\s*\}$/,"$1"),Object.assign({},e,{displayValue:t});if(!e.altType)return Object.assign({},e,{displayValue:t});e.type=e.altType}if("json"===e.type)return Object.assign({},e,{displayValue:JSON.stringify(e.value)});if("color"===e.type){const i=function(e){if(!e)return[255,255,255,0];if(Array.isArray(e))return e.slice(0,4);const t=(0,M.Qh)(e);return[t.r,t.g,t.b,255]}(e.value);return Object.assign({},e,{value:i,displayValue:(t=i,t.slice(0,3).reduce((e,t)=>e+(t<16?"0":"")+t.toString(16),"#"))})}var t;return Object.assign({},e,{displayValue:String(e.value)})};var T=i(340),D=i(8180);const E=o.Ay.div.withConfig({displayName:"make-example__DemoContainer",componentId:"sc-is6oih-0"})([".tooltip,.deck-tooltip{position:absolute;padding:4px 12px;background:rgba(0,0,0,0.8);color:var(--ifm-color-white);max-width:300px;font-size:12px;z-index:9;pointer-events:none;white-space:nowrap;}"]),I=o.Ay.div.withConfig({displayName:"make-example__MapTip",componentId:"sc-is6oih-1"})(["position:absolute;right:12px;bottom:20px;color:var(--ifm-color-white);mix-blend-mode:difference;font-size:14px;@media screen and (max-width:480px){display:none;}"]);function _(e,t){let{isInteractive:i=!0,style:o}=void 0===t?{}:t;const{parameters:s={},mapStyle:r}=e,a=Object.keys(s).reduce((e,t)=>(e[t]=F(s[t]),e),{}),l=Array.isArray(e.data)?e.data.map(e=>null):null;return function(){const[t,s]=(0,n.useState)(l),[d,c]=(0,n.useState)(a),[p,g]=(0,n.useState)({}),u=(0,D.Ay)("/"),m=(0,n.useCallback)(e=>{const t=Object.keys(e).reduce((t,i)=>(t[i]=F(e[i]),t),{});c(e=>Object.assign({},e,t))},[]),f=(0,n.useCallback)(e=>{g(t=>Object.assign({},t,e))},[]);(0,n.useEffect)(()=>{let t=e.data;if(!t)return;const i=Array.isArray(t);i||(t=[t]);for(let e=0;e<t.length;e++){const{url:n,worker:o}=t[e];A(j(u,n),o&&j(u,o),(t,n)=>{s(i?i=>{const n=i.slice();return n[e]=t,n}:t),n&&g(e=>Object.assign({},e,n))})}},[]);return(0,h.jsxs)(E,{style:o,children:[(0,h.jsx)(e,{data:t,mapStyle:r||T.Vi.BLANK,params:d,useParam:m,onStateChange:f}),i&&(0,h.jsx)(P,{title:e.title,params:d,meta:p,updateParam:(e,t)=>{const i=d[e];i&&c(Object.assign({},d,{[e]:F(Object.assign({},i,{value:t}))}))},sourceLink:e.code,children:e.renderInfo(p)}),i&&r&&(0,h.jsx)(I,{children:"Hold down shift to rotate"})]})}}var L=i(40);const O=o.Ay.div.withConfig({displayName:"styled__ExampleHeader",componentId:"sc-1dgi8sb-0"})(["font:bold 20px/28px var(--ifm-font-family-base);color:var(--ifm-color-content-secondary);margin:0 20px;border-bottom:1px solid 20px;display:inline-block;padding:20px 20px 4px 0;"]),H=o.Ay.main.withConfig({displayName:"styled__MainExamples",componentId:"sc-1dgi8sb-1"})(["padding:16px 0;"]),z=o.Ay.main.withConfig({displayName:"styled__ExamplesGroup",componentId:"sc-1dgi8sb-2"})(["display:flex;flex-wrap:wrap;padding:16px;"]),R=o.Ay.a.withConfig({displayName:"styled__ExampleCard",componentId:"sc-1dgi8sb-3"})(["cursor:pointer;text-decoration:none;width:50%;max-width:240px;line-height:0;outline:none;padding:4px;position:relative;img{transition-property:filter;transition-duration:var(--ifm-transition-slow);transition-timing-function:var(--ifm-transition-timing-default);}&:hover{box-shadow:var(--ifm-global-shadow-md);}&:hover img{filter:contrast(0.2);}","{width:33%;min-width:200px;}@media screen and (max-width:632px){width:50%;}"],s),N=o.Ay.div.withConfig({displayName:"styled__ExampleTitle",componentId:"sc-1dgi8sb-4"})(["position:absolute;display:flex;justify-content:center;flex-direction:column;color:var(--ifm-color-white);font-size:1.5em;text-align:center;line-height:initial;width:90%;height:90%;top:5%;left:5%;border:solid 1px var(--ifm-color-white);opacity:0;transition-property:opacity;transition-duration:var(--ifm-transition-slow);transition-timing-function:var(--ifm-transition-timing-default);&:hover{opacity:1;}"]);function q(e,t){let{label:i,items:n}=e;return[(0,h.jsx)(O,{children:i},i+"-header"),(0,h.jsx)(z,{children:n.map(e=>function(e,t){const i=(0,D.Ay)(t(e)),{label:n,href:o}=e;return(0,h.jsxs)(R,{href:o,children:[(0,h.jsx)("img",{width:"100%",src:i,alt:n}),(0,h.jsx)(N,{children:(0,h.jsx)("span",{children:n})})]},n)}(e,t))},i)]}function G(e){let{getThumbnail:t}=e;const i=(0,L.t)();return(0,h.jsx)(H,{children:i.items.map(e=>"category"===e.type?q(e,t):null)})}var U=i(7639);const B=o.Ay.section.withConfig({displayName:"styled__Banner",componentId:"sc-exnbu5-0"})(["position:relative;height:30rem;background:var(--ifm-color-gray-400);color:var(--ifm-color-gray-900);z-index:0;","{height:80vh;}"],s),W=o.Ay.div.withConfig({displayName:"styled__Container",componentId:"sc-exnbu5-1"})(["position:relative;padding:2rem;max-width:80rem;width:100%;height:100%;margin:0;"]),J=(0,o.Ay)(W).withConfig({displayName:"styled__BannerContainer",componentId:"sc-exnbu5-2"})(["position:absolute;bottom:0;height:auto;padding-left:4rem;z-index:0;pointer-events:none;"]),V=o.Ay.div.withConfig({displayName:"styled__HeroExampleContainer",componentId:"sc-exnbu5-3"})(["position:absolute;top:0;left:0;right:0;bottom:0;z-index:-1;"]),K=(o.Ay.section.withConfig({displayName:"styled__Section",componentId:"sc-exnbu5-4"})(["&:nth-child(2n + 1){background:var(--ifm-color-gray-300);}"]),o.Ay.h1.withConfig({displayName:"styled__ProjectName",componentId:"sc-exnbu5-5"})(["font-size:5em;line-height:1;text-transform:uppercase;letter-spacing:4px;font-weight:700;margin:0;margin-bottom:16px;"])),Z=o.Ay.a.withConfig({displayName:"styled__GetStartedLink",componentId:"sc-exnbu5-6"})(["pointer-events:all;font-size:12px;line-height:44px;letter-spacing:2px;font-weight:bold;margin:24px 0;padding:0 4rem;pointer-events:all;display:inline-block;text-decoration:none;transition:background-color 250ms ease-in,color 250ms ease-in;border:solid 2px var(--ifm-color-primary);color:var(--ifm-color-gray-900);border-image:linear-gradient( to right,var(--ifm-color-gray-700) 0%,var(--ifm-color-gray-400) 100% );border-image-slice:2;&:visited{color:var(--ifm-color-gray-900);}&:active{color:var(--ifm-color-white);}&:hover{color:var(--ifm-color-white);background-color:var(--ifm-color-primary);}"]);function X(e){let{HeroExample:t,children:i}=e;const{siteConfig:n}=(0,U.A)();return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsxs)(B,{children:[(0,h.jsx)(V,{children:t&&(0,h.jsx)(t,{})}),(0,h.jsxs)(J,{children:[(0,h.jsx)(K,{children:n.title}),(0,h.jsx)("p",{children:n.tagline}),(0,h.jsx)(Z,{href:"./docs",children:"GET STARTED"})]})]}),i]})}},4653:(e,t,i)=>{i.d(t,{H2:()=>Ue,Jt:()=>ze,O5:()=>Ee,Zy:()=>De,UP:()=>_e,hP:()=>He,DS:()=>Ce,i_:()=>fe,G2:()=>qe,cR:()=>ve,E6:()=>je,hh:()=>we,UD:()=>Oe,OH:()=>Me,Vv:()=>Ae,ls:()=>le,Tp:()=>ut,IM:()=>Dt,l$:()=>me,X5:()=>It,fb:()=>ge,Dx:()=>Rt,vX:()=>Ht,L6:()=>Lt,uq:()=>te,C$:()=>Et,Dr:()=>ae,Sn:()=>d,GN:()=>se,cW:()=>Ft,UX:()=>Ge,m0:()=>he,_C:()=>Be,O1:()=>ee,nE:()=>K});var n=i(3279),o=i(5917),s=i(1234),r=i(6599),a=i(365),l=i(669);const d={NONE:null,RECTANGLE:"rectangle",POLYGON:"polygon"};var c=i(228);i(4526);c.EventEmitter;var p=i(6558),h=i(7604),g=i(7885),u=i(7531);var m=i(9452),f=i(8095);class y extends m.A{renderLayers(){const{id:e,getFillColor:t,getStrokeColor:i,getInnerRadius:n,updateTriggers:o}=this.props;return[new f.A(Object.assign({},this.props,{id:e+"-full",data:this.props.data,getLineColor:i,updateTriggers:Object.assign({},o,{getStrokeColor:o.getStrokeColor})})),new f.A(Object.assign({},this.props,{id:e+"-inner",data:this.props.data,getFillColor:t,getRadius:n,pickable:!1,updateTriggers:Object.assign({},o,{getFillColor:o.getFillColor,getRadius:o.getInnerRadius})}))]}}y.layerName="JunctionScatterplotLayer",y.defaultProps=Object.assign({},f.A.defaultProps,{getFillColor:e=>[0,0,0,255],getStrokeColor:e=>[255,255,255,255],getInnerRadius:e=>1});var x=i(1388);i(6467);var C=i(8894),v=i(3178),b=i(4657),P=i(5475),S=i(8364),w=i(9987),k=i(5046);function A(e,t,i){if(!Array.isArray(e[0]))return!0;for(let n=0;n<e.length;n++)if(A(e[n],[...t,n],i)){i(e,t);break}return!1}function j(e,t,i){const o={type:"LineString",coordinates:[e,t]},s=(0,n.zx)(i),r=(0,g.A)(s,o),a=(0,h.A)(e,t),l=(i[0]-e[0])*(t[1]-e[1])-(i[1]-e[1])*(t[0]-e[0])<0?a-90:a-270,d=(0,p.A)(t,r,l),c=(0,p.A)(e,r,l);return[d.geometry.coordinates,c.geometry.coordinates]}function M(e,t,i,n){const o=e-i,s=t-n;return Math.sqrt(o*o+s*s)}function F(e,t,i){const n=new u.KH(i),o=e.geometry.coordinates.map(e=>{let[t,i,o=0]=e;return n.project([t,i,o])}),[s,r]=n.project(t.geometry.coordinates);let a=1/0,l={};o.forEach((e,t)=>{let[i,n]=e;if(0===t)return;const[d,c]=o[t-1],p=c-n,h=i-d,g=d*n-i*c,u=p*p+h*h,m=Math.abs(p*s+h*r+g)/Math.sqrt(u);m<a&&(a=m,l={index:t,x0:(h*(h*s-p*r)-p*g)/u,y0:(p*(-h*s+p*r)-h*g)/u})});const{index:d,x0:c,y0:p}=l,[h,g,m=0]=o[d-1],[f,y,x=0]=o[d],C=M(h,g,f,y),v=function(e,t,i){return t*i+e*(1-i)}(m,x,M(h,g,c,p)/C);return{type:"Feature",geometry:{type:"Point",coordinates:n.unproject([c,p,v])},properties:{dist:a,index:d-1}}}function T(e){const t=I(e);return t.length?t[0]:null}function D(e){return I(e).find(e=>{let{properties:t}=e;return t.featureIndex>=0&&"existing"===t.editHandleType})}function E(e){return I(e).find(e=>{let{properties:t}=e;return t.featureIndex>=0&&"intermediate"===t.editHandleType})}function I(e){return e&&e.filter(e=>e.isGuide&&"editHandle"===e.object.properties.guideType).map(e=>e.object)||[]}function _(e,t,i){void 0===i&&(i="existing");let n=[];switch(e.type){case"Point":n=[{type:"Feature",properties:{guideType:"editHandle",editHandleType:i,positionIndexes:[],featureIndex:t},geometry:{type:"Point",coordinates:e.coordinates}}];break;case"MultiPoint":case"LineString":n=n.concat(L(e.coordinates,[],t,i));break;case"Polygon":case"MultiLineString":for(let o=0;o<e.coordinates.length;o++)n=n.concat(L(e.coordinates[o],[o],t,i)),"Polygon"===e.type&&(n=n.slice(0,-1));break;case"MultiPolygon":for(let o=0;o<e.coordinates.length;o++)for(let s=0;s<e.coordinates[o].length;s++)n=n.concat(L(e.coordinates[o][s],[o,s],t,i)),n=n.slice(0,-1);break;default:throw Error("Unhandled geometry type: "+e.type)}return n}function L(e,t,i,n){void 0===n&&(n="existing");const o=[];for(let s=0;s<e.length;s++){const r=e[s];o.push({type:"Feature",properties:{guideType:"editHandle",positionIndexes:[...t,s],featureIndex:i,editHandleType:n},geometry:{type:"Point",coordinates:r}})}return o}function O(e,t){return"number"==typeof e[0]?!isNaN(e[0])&&isFinite(e[0])?t(e):e:e.map(e=>O(e,t)).filter(Boolean)}function H(e){return e.picks.length&&e.picks.find(e=>"points"===e.featureType)}class z{constructor(e){this.featureCollection=e}getObject(){return this.featureCollection}replacePosition(e,t,i){const n=this.featureCollection.features[e].geometry,o="Polygon"===n.type||"MultiPolygon"===n.type,s=Object.assign({},n,{coordinates:N(n.coordinates,t,i,o)});return this.replaceGeometry(e,s)}removePosition(e,t){const i=this.featureCollection.features[e].geometry;if("Point"===i.type)throw Error("Can't remove a position from a Point or there'd be nothing left");if("MultiPoint"===i.type&&i.coordinates.length<2)throw Error("Can't remove the last point of a MultiPoint or there'd be nothing left");if("LineString"===i.type&&i.coordinates.length<3)throw Error("Can't remove position. LineString must have at least two positions");if("Polygon"===i.type&&i.coordinates[0].length<5&&Array.isArray(t)&&0===t[0])throw Error("Can't remove position. Polygon's outer ring must have at least four positions");if("MultiLineString"===i.type&&1===i.coordinates.length&&i.coordinates[0].length<3)throw Error("Can't remove position. MultiLineString must have at least two positions");if("MultiPolygon"===i.type&&1===i.coordinates.length&&i.coordinates[0][0].length<5&&Array.isArray(t)&&0===t[0]&&0===t[1])throw Error("Can't remove position. MultiPolygon's outer ring must have at least four positions");const n="Polygon"===i.type||"MultiPolygon"===i.type,o=Object.assign({},i,{coordinates:q(i.coordinates,t,n)});return function(e){switch(e.type){case"Polygon":!function(e){const t=e.coordinates;for(let i=1;i<t.length;i++)U(t,i)&&i--}(e);break;case"MultiLineString":!function(e){for(let t=0;t<e.coordinates.length;t++){1===e.coordinates[t].length&&(e.coordinates.splice(t,1),t--)}}(e);break;case"MultiPolygon":!function(e){for(let t=0;t<e.coordinates.length;t++){const i=e.coordinates[t];i[0].length<=3&&(e.coordinates.splice(t,1),t--);for(let e=1;e<i.length;e++)U(i,e)&&e--}}(e)}}(o),this.replaceGeometry(e,o)}addPosition(e,t,i){const n=this.featureCollection.features[e].geometry;if("Point"===n.type)throw new Error("Unable to add a position to a Point feature");const o="Polygon"===n.type||"MultiPolygon"===n.type,s=Object.assign({},n,{coordinates:G(n.coordinates,t,i,o)});return this.replaceGeometry(e,s)}replaceGeometry(e,t){const i=Object.assign({},this.featureCollection.features[e],{geometry:t}),n=Object.assign({},this.featureCollection,{features:[...this.featureCollection.features.slice(0,e),i,...this.featureCollection.features.slice(e+1)]});return new z(n)}addFeature(e){return this.addFeatures([e])}addFeatures(e){const t=Object.assign({},this.featureCollection,{features:[...this.featureCollection.features,...e]});return new z(t)}deleteFeature(e){return this.deleteFeatures([e])}deleteFeatures(e){const t=[...this.featureCollection.features];e.sort();for(let n=e.length-1;n>=0;n--){const i=e[n];i>=0&&i<t.length&&t.splice(i,1)}const i=Object.assign({},this.featureCollection,{features:t});return new z(i)}}function R(e,t){if(2===e.length&&3===t.length){const i=t[2];return[e[0],e[1],i]}return e}function N(e,t,i,n){if(!t)return e;if(0===t.length)return R(i,e);if(1===t.length){const o=[...e.slice(0,t[0]),R(i,e[t[0]]),...e.slice(t[0]+1)];return!n||0!==t[0]&&t[0]!==e.length-1||(o[0]=R(i,e[0]),o[e.length-1]=R(i,e[0])),o}return[...e.slice(0,t[0]),N(e[t[0]],t.slice(1,t.length),i,n),...e.slice(t[0]+1)]}function q(e,t,i){if(!t)return e;if(0===t.length)throw Error("Must specify the index of the position to remove");if(1===t.length){const n=[...e.slice(0,t[0]),...e.slice(t[0]+1)];return!i||0!==t[0]&&t[0]!==e.length-1||(0===t[0]?n[n.length-1]=n[0]:t[0]===e.length-1&&(n[0]=n[n.length-1])),n}return[...e.slice(0,t[0]),q(e[t[0]],t.slice(1,t.length),i),...e.slice(t[0]+1)]}function G(e,t,i,n){if(!t)return e;if(0===t.length)throw Error("Must specify the index of the position to remove");if(1===t.length){return[...e.slice(0,t[0]),i,...e.slice(t[0])]}return[...e.slice(0,t[0]),G(e[t[0]],t.slice(1,t.length),i,n),...e.slice(t[0]+1)]}function U(e,t){return e[t].length<=3&&(e.splice(t,1),!0)}const B={type:"FeatureCollection",features:[]},W=[];class J{constructor(){this._clickSequence=[]}getGuides(e){return B}getTooltips(e){return W}getSelectedFeature(e){return 1===e.selectedIndexes.length?e.data.features[e.selectedIndexes[0]]:null}getSelectedGeometry(e){const t=this.getSelectedFeature(e);return t?t.geometry:null}getSelectedFeaturesAsFeatureCollection(e){const{features:t}=e.data;return{type:"FeatureCollection",features:e.selectedIndexes.map(e=>t[e])}}getClickSequence(){return this._clickSequence}addClickSequence(e){let{mapCoords:t}=e;this._clickSequence.push(t)}resetClickSequence(){this._clickSequence=[]}getTentativeGuide(e){return this.getGuides(e).features.find(e=>e.properties&&"tentative"===e.properties.guideType)}isSelectionPicked(e,t){if(!e.length)return!1;const i=function(e){return e&&e.filter(e=>!e.isGuide)}(e).map(e=>{let{index:t}=e;return t}),n=I(e).map(e=>{let{properties:t}=e;return t.featureIndex}),o=new Set([...i,...n]);return t.selectedIndexes.some(e=>o.has(e))}rewindPolygon(e){const{geometry:t}=e;return"Polygon"===t.type||"MultiPolygon"===t.type?(0,S.A)(e):e}getAddFeatureAction(e,t,i){const n=e;i=i||{};const o="Feature"===n.type?n:{type:"Feature",properties:i,geometry:n},s=this.rewindPolygon(o),r=new z(t).addFeature(s).getObject();return{updatedData:r,editType:"addFeature",editContext:{featureIndexes:[r.features.length-1]}}}getAddManyFeaturesAction(e,t){let{features:i}=e,n=new z(t);const o=n.getObject().features.length,s=[];for(const r of i){const{properties:e,geometry:t}=r,i=t;n=n.addFeature({type:"Feature",properties:e,geometry:i}),s.push(o+s.length)}return{updatedData:n.getObject(),editType:"addFeature",editContext:{featureIndexes:s}}}getAddFeatureOrBooleanPolygonAction(e,t,i){const n=e;i=i||{};const o=this.getSelectedFeature(t),{modeConfig:s}=t;if(s&&s.booleanOperation){if(!o||"Polygon"!==o.geometry.type&&"MultiPolygon"!==o.geometry.type)return console.warn("booleanOperation only supported for single Polygon or MultiPolygon selection"),null;const e="Feature"===n.type?n:{type:"Feature",geometry:n};let i;if("union"===s.booleanOperation)i=(0,b.A)(o,e);else if("difference"===s.booleanOperation)i=(0,a.A)(o,e);else{if("intersection"!==s.booleanOperation)return console.warn("Invalid booleanOperation "+s.booleanOperation),null;i=(0,P.A)(o,e)}if(!i)return console.warn("Canceling edit. Boolean operation erased entire polygon."),null;const r=t.selectedIndexes[0];return{updatedData:new z(t.data).replaceGeometry(r,i.geometry).getObject(),editType:"unionGeometry",editContext:{featureIndexes:[r]}}}return this.getAddFeatureAction(e,t.data,i)}createTentativeFeature(e){return null}handleClick(e,t){}handlePointerMove(e,t){const i=this.createTentativeFeature(t);i&&t.onEdit({updatedData:t.data,editType:"updateTentativeFeature",editContext:{feature:i}})}handleStartDragging(e,t){}handleStopDragging(e,t){}handleDragging(e,t){}handleKeyUp(e,t){"Escape"===e.key&&(this.resetClickSequence(),t.onEdit({updatedData:t.data,editType:"cancelFeature",editContext:{}}))}}function V(e,t){return[(e[0]+t[0])/2,(e[1]+t[1])/2]}class K extends J{}var Z=i(7083),X=i(5903),Q=i(7743),Y=i(8664),$=i(7861);class ee extends J{constructor(){super(...arguments),this._isTranslatable=void 0}handleDragging(e,t){if(this._isTranslatable){if(this._geometryBeforeTranslate){const i=this.getTranslateAction(e.pointerDownMapCoords,e.mapCoords,"translating",t);i&&t.onEdit(i)}e.cancelPan()}}handlePointerMove(e,t){this._isTranslatable=this.isSelectionPicked(e.pointerDownPicks||e.picks,t),this.updateCursor(t)}handleStartDragging(e,t){this._isTranslatable&&(e.cancelPan(),this._geometryBeforeTranslate=this.getSelectedFeaturesAsFeatureCollection(t))}handleStopDragging(e,t){if(this._geometryBeforeTranslate){const i=this.getTranslateAction(e.pointerDownMapCoords,e.mapCoords,"translated",t);i&&t.onEdit(i),this._geometryBeforeTranslate=null}}updateCursor(e){this._isTranslatable?e.onUpdateCursor("move"):e.onUpdateCursor(null)}getTranslateAction(e,t,i,o){if(!this._geometryBeforeTranslate)return null;let s=new z(o.data);const r=o.selectedIndexes,{viewport:a,screenSpace:d}=o.modeConfig||{};if(a&&d){const i=a.project?a:new u.KH(a),n=i.project(e),o=i.project(t),l=o[0]-n[0],d=o[1]-n[1];for(let e=0;e<r.length;e++){const t=r[e],n=this._geometryBeforeTranslate.features[e];let o=n.geometry.coordinates;o&&(o=O(o,e=>{const t=i.project(e);return t?(t[0]+=l,t[1]+=d,i.unproject(t)):null}),s=s.replaceGeometry(t,{type:n.geometry.type,coordinates:o}))}}else{const i=(0,n.zx)(e),o=(0,n.zx)(t),a=(0,l.A)(i,o),d=(0,h.A)(i,o),c=this._geometryBeforeTranslate.features.map(e=>function(e,t,i){const n=(0,X.A)(e),o=(0,$.A)(n,t,i),s=O(e.geometry.coordinates,e=>{const t=(0,Y.A)(n.geometry.coordinates,e),i=(0,Q.A)(n.geometry.coordinates,e);return(0,$.A)(o.geometry.coordinates,t,i).geometry.coordinates});return e.geometry.coordinates=s,e}((0,Z.A)(e),a,d));for(let e=0;e<r.length;e++){const t=r[e],i=c[e];s=s.replaceGeometry(t,i.geometry)}}return{updatedData:s.getObject(),editType:i,editContext:{featureIndexes:r}}}}class te extends J{getGuides(e){const t=[],{data:i,lastPointerMoveEvent:o}=e,{features:s}=i,r=o&&o.picks,a=o&&o.mapCoords;for(const n of e.selectedIndexes)if(n<s.length){const{geometry:e}=s[n];t.push(..._(e,n))}else console.warn("selectedFeatureIndexes out of range "+n);if(r&&r.length&&a){var l;const i=!D(r)&&r.find(e=>!e.isGuide);if(i&&!i.object.geometry.type.includes("Point")&&(null==(l=e.modeConfig)||!l.lockRectangles||"Rectangle"!==i.object.properties.shape)&&e.selectedIndexes.includes(i.index)){let o=null,s=[];const r=(0,n.zx)(a);if(A(i.object.geometry.coordinates,[],(t,i)=>{const a=(0,n.wi)(t),l=this.getNearestPoint(a,r,e.modeConfig&&e.modeConfig.viewport);(!o||l.properties.dist<o.properties.dist)&&(o=l,s=i)}),o){const{geometry:{coordinates:e},properties:{index:n}}=o;t.push({type:"Feature",properties:{guideType:"editHandle",editHandleType:"intermediate",featureIndex:i.index,positionIndexes:[...s,n+1]},geometry:{type:"Point",coordinates:e}})}}}return{type:"FeatureCollection",features:t}}getNearestPoint(e,t,i){const{coordinates:o}=e.geometry;if(o.some(e=>e.length>2)){if(i)return F(e,t,i);console.log("Editing 3D point but modeConfig.viewport not provided. Falling back to 2D logic.")}return function(e,t,i){var o,s;let r;i&&(r=new u.KH(i));let a=(0,n.zx)([1/0,1/0],{dist:1/0});return null==(o=e.geometry)||!o.coordinates.length||(null==(s=e.geometry)?void 0:s.coordinates.length)<2||(0,w.iw)(e,e=>{const i=(0,k.$R)(e),o=(0,k.$R)(t);let s,l,d,c,p,h,g;if(i.length>1&&o.length){let e,t;r?(e=i.map(e=>r.project(e)),t=r.project(o)):(e=i,t=o);for(let i=1;i<e.length;i++){if(e[i][0]!==e[i-1][0]){const n=(e[i][1]-e[i-1][1])/(e[i][0]-e[i-1][0]),o=e[i][1]-n*e[i][0];g=Math.abs(n*t[0]+o-t[1])/Math.sqrt(n*n+1)}else g=Math.abs(t[0]-e[i][0]);const n=Math.pow(e[i][1]-e[i-1][1],2)+Math.pow(e[i][0]-e[i-1][0],2),o=Math.pow(e[i][1]-t[1],2)+Math.pow(e[i][0]-t[0],2),r=Math.pow(e[i-1][1]-t[1],2)+Math.pow(e[i-1][0]-t[0],2),a=Math.pow(g,2),c=o-a+r-a;c>n&&(g=Math.sqrt(Math.min(o,r))),(null==s||s>g)&&(c>n?r<o?(l=0,d=1):(d=0,l=1):(l=Math.sqrt(r-a)/Math.sqrt(n),d=Math.sqrt(o-a)/Math.sqrt(n)),s=g,h=i)}const n=e[h-1][0]-e[h][0],a=e[h-1][1]-e[h][1];c=e[h-1][0]-n*l,p=e[h-1][1]-a*l}let u={x:c,y:p,idx:h-1,to:l,from:d};if(r){const e=r.unproject([u.x,u.y]);u={x:e[0],y:e[1],idx:h-1,to:l,from:d}}a=(0,n.zx)([u.x,u.y],{dist:Math.abs(u.from-u.to),index:u.idx})}),a}(e,t,i)}handleClick(e,t){const i=D(e.picks),n=E(e.picks);if(i){const{featureIndex:e,positionIndexes:n}=i.properties;let o;try{o=new z(t.data).removePosition(e,n).getObject()}catch(s){}o&&t.onEdit({updatedData:o,editType:"removePosition",editContext:{featureIndexes:[e],positionIndexes:n,position:i.geometry.coordinates}})}else if(n){var o;const{featureIndex:e,positionIndexes:i}=n.properties,s=t.data.features[e];if(!(null!=(o=t.modeConfig)&&o.lockRectangles&&"Rectangle"===(null==s?void 0:s.properties.shape))){const o=new z(t.data).addPosition(e,i,n.geometry.coordinates).getObject();o&&t.onEdit({updatedData:o,editType:"addPosition",editContext:{featureIndexes:[e],positionIndexes:i,position:n.geometry.coordinates}})}}}handleDragging(e,t){const i=T(e.pointerDownPicks);i&&(e.cancelPan(),this._dragEditHandle("movePosition",t,i,e))}_dragEditHandle(e,t,i,n){var o;const s=i.properties,r=t.data.features[s.featureIndex];let a;if(null!=(o=t.modeConfig)&&o.lockRectangles&&"Rectangle"===r.properties.shape){const e=function(e,t,i){const n=e.geometry.coordinates;if(!n)return null;const o=n[0].slice(0,4);o[t%4]=i;const s=o[(t+2)%4],r=o[t%4];return o[(t+1)%4]=[r[0],s[1]],o[(t+3)%4]=[s[0],r[1]],[[...o,o[0]]]}(r,s.positionIndexes[1],n.mapCoords);a=new z(t.data).replaceGeometry(s.featureIndex,{coordinates:e,type:"Polygon"}).getObject()}else a=new z(t.data).replacePosition(s.featureIndex,s.positionIndexes,n.mapCoords).getObject();t.onEdit({updatedData:a,editType:e,editContext:{featureIndexes:[s.featureIndex],positionIndexes:s.positionIndexes,position:n.mapCoords}})}handlePointerMove(e,t){const i=this.getCursor(e);t.onUpdateCursor(i)}handleStartDragging(e,t){H(e)&&e.cancelPan();const i=t.selectedIndexes,n=E(e.picks);if(i.length&&n){const i=n.properties,o=new z(t.data).addPosition(i.featureIndex,i.positionIndexes,e.mapCoords).getObject();t.onEdit({updatedData:o,editType:"addPosition",editContext:{featureIndexes:[i.featureIndex],positionIndexes:i.positionIndexes,position:e.mapCoords}})}}handleStopDragging(e,t){const i=t.selectedIndexes,n=T(e.picks);i.length&&n&&this._dragEditHandle("finishMovePosition",t,n,e)}getCursor(e){return I(e&&e.picks||[]).length?"cell":null}}var ie=i(7450),ne=i(5875),oe=i(1349);class se extends J{constructor(){super(...arguments),this._cornerGuidePoints=[],this._isScaling=!1,this._isSinglePointGeometrySelected=e=>{const{features:t}=e||{};if(Array.isArray(t)&&1===t.length){const{type:e}=(0,k.bg)(t[0]);return"Point"===e}return!1},this._getOppositeScaleHandle=e=>{const t=e&&e.properties&&Array.isArray(e.properties.positionIndexes)&&e.properties.positionIndexes[0];if("number"!=typeof t)return null;const i=this._cornerGuidePoints.length,n=(t+i/2)%i;return this._cornerGuidePoints.find(e=>!!Array.isArray(e.properties.positionIndexes)&&e.properties.positionIndexes[0]===n)||null},this._getUpdatedData=(e,t)=>{let i=new z(e.data);const n=e.selectedIndexes;for(let o=0;o<n.length;o++){const e=n[o],s=t.features[o];i=i.replaceGeometry(e,s.geometry)}return i.getObject()},this.isEditHandleSelected=()=>Boolean(this._selectedEditHandle),this.getScaleAction=(e,t,i,n)=>{if(!this._selectedEditHandle)return null;const o=this._getOppositeScaleHandle(this._selectedEditHandle),s=(0,k.uG)(o),r=function(e,t,i){const n=(0,l.A)(e,t),o=(0,l.A)(e,i);return o/n}(s,e,t),a=(0,oe.A)(this._geometryBeingScaled,r,{origin:s});return{updatedData:this._getUpdatedData(n,a),editType:i,editContext:{featureIndexes:n.selectedIndexes}}},this.updateCursor=e=>{if(this._selectedEditHandle){this._cursor&&e.onUpdateCursor(this._cursor);const t=this.getSelectedFeaturesAsFeatureCollection(e),i=(0,ie.A)(t),n=(0,h.A)(i,this._selectedEditHandle),o=n<0?n+180:n;o>=0&&o<=90||o>=180&&o<=270?(this._cursor="nesw-resize",e.onUpdateCursor("nesw-resize")):(this._cursor="nwse-resize",e.onUpdateCursor("nwse-resize"))}else e.onUpdateCursor(null),this._cursor=null}}handlePointerMove(e,t){if(!this._isScaling){const i=T(e.picks);this._selectedEditHandle=i&&"scale"===i.properties.editHandleType?i:null,this.updateCursor(t)}}handleStartDragging(e,t){this._selectedEditHandle&&(e.cancelPan(),this._isScaling=!0,this._geometryBeingScaled=this.getSelectedFeaturesAsFeatureCollection(t))}handleDragging(e,t){if(!this._isScaling)return;t.onUpdateCursor(this._cursor);const i=this.getScaleAction(e.pointerDownMapCoords,e.mapCoords,"scaling",t);i&&t.onEdit(i),e.cancelPan()}handleStopDragging(e,t){if(this._isScaling){const i=this.getScaleAction(e.pointerDownMapCoords,e.mapCoords,"scaled",t);i&&t.onEdit(i),t.onUpdateCursor(null),this._geometryBeingScaled=null,this._selectedEditHandle=null,this._cursor=null,this._isScaling=!1}}getGuides(e){this._cornerGuidePoints=[];const t=this.getSelectedFeaturesAsFeatureCollection(e);if(this._isSinglePointGeometrySelected(t))return{type:"FeatureCollection",features:[]};const i=(0,s.A)((0,o.A)(t));i.properties.mode="scale";const r=[];return(0,w.Fh)(i,(e,t)=>{if(t<4){const i=(0,n.zx)(e,{guideType:"editHandle",editHandleType:"scale",positionIndexes:[t]});r.push(i)}}),this._cornerGuidePoints=r,(0,n.Lr)([(0,ne.CN)(i),...this._cornerGuidePoints])}}var re=i(5486);class ae extends J{constructor(){super(...arguments),this._isRotating=!1,this._isSinglePointGeometrySelected=e=>{const{features:t}=e||{};if(Array.isArray(t)&&1===t.length){const{type:e}=(0,k.bg)(t[0]);return"Point"===e}return!1},this.getIsRotating=()=>this._isRotating}getGuides(e){const t=this._geometryBeingRotated||this.getSelectedFeaturesAsFeatureCollection(e);if(this._isSinglePointGeometrySelected(t))return{type:"FeatureCollection",features:[]};if(this._isRotating)return(0,n.Lr)([(0,ie.A)(t)]);const i=(0,s.A)((0,o.A)(t));let r=null,a=null,d=0;(0,w.Fh)(i,e=>{if(r){const t=V(e,r);(!a||t[1]>a[1])&&(a=t);const i=(0,l.A)(e,r);d=Math.max(d,i)}r=e});const c=a&&[a[0],a[1]+d/1e3],p=(0,n.wi)([a,c]),h=(0,n.zx)(c,{guideType:"editHandle",editHandleType:"rotate"}),g=[(0,ne.CN)(i),h,p];return(0,n.Lr)(g)}handleDragging(e,t){if(!this._isRotating)return;const i=this.getRotateAction(e.pointerDownMapCoords,e.mapCoords,"rotating",t);i&&t.onEdit(i),e.cancelPan()}handlePointerMove(e,t){if(!this._isRotating){const t=T(e.picks);this._selectedEditHandle=t&&"rotate"===t.properties.editHandleType?t:null}this.updateCursor(t)}handleStartDragging(e,t){this._selectedEditHandle&&(e.cancelPan(),this._isRotating=!0,this._geometryBeingRotated=this.getSelectedFeaturesAsFeatureCollection(t))}handleStopDragging(e,t){if(this._isRotating){const i=this.getRotateAction(e.pointerDownMapCoords,e.mapCoords,"rotated",t);i&&t.onEdit(i),this._geometryBeingRotated=null,this._selectedEditHandle=null,this._isRotating=!1}}updateCursor(e){this._selectedEditHandle?e.onUpdateCursor("crosshair"):e.onUpdateCursor(null)}getRotateAction(e,t,i,n){if(!this._geometryBeingRotated)return null;const o=(0,ie.A)(this._geometryBeingRotated),s=function(e,t,i){const n=(0,h.A)(e,t),o=(0,h.A)(e,i);return o-n}(o,e,t),r=(0,re.A)(this._geometryBeingRotated,s,{pivot:o});let a=new z(n.data);const l=n.selectedIndexes;for(let d=0;d<l.length;d++){const e=l[d],t=r.features[d];a=a.replaceGeometry(e,t.geometry)}return{updatedData:a.getObject(),editType:i,editContext:{featureIndexes:l}}}}class le extends ee{handleStartDragging(e,t){super.handleStartDragging(e,t),this._geometryBeforeTranslate&&t.onEdit(this.getAddManyFeaturesAction(this._geometryBeforeTranslate,t.data))}updateCursor(e){this._isTranslatable?e.onUpdateCursor("copy"):e.onUpdateCursor(null)}}var de=i(2608),ce=i(5085),pe=i(7028);class he extends J{calculateMapCoords(e,t,i){const o=i.modeConfig;if(!o||!o.lock90Degree||!e.length)return t;if(1===e.length){const n=e[0],o=this.getSelectedGeometry(i),s=(0,ne.Ay)(o),r="FeatureCollection"===s.type?s.features:[s];let a=Number.MAX_SAFE_INTEGER,d=null;if(r.forEach(e=>{const t=(0,pe.A)(e,n),i=(0,l.A)(t,n);a>i&&(a=i,d=t)}),d){const e=(0,h.A)(n,d),i=(0,l.A)(n,t,{units:"meters"});return(0,p.A)(n,i,e,{units:"meters"}).geometry.coordinates}return t}const s=e[e.length-1],[r]=j(e[e.length-2],s,t);return(0,pe.A)((0,n.wi)([s,r]),t).geometry.coordinates}getGuides(e){const t=this.getClickSequence(),i={type:"FeatureCollection",features:[]};if(0===t.length||!e.lastPointerMoveEvent)return i;const{mapCoords:n}=e.lastPointerMoveEvent;return i.features.push({type:"Feature",properties:{guideType:"tentative"},geometry:{type:"LineString",coordinates:[...t,this.calculateMapCoords(t,n,e)]}}),i}handleClick(e,t){const i=this.getTentativeGuide(t),n=this.getSelectedGeometry(t);if(!n)return void console.warn("A polygon must be selected for splitting");const o=this.getClickSequence();i&&"LineString"===i.geometry.type?o.push(i.geometry.coordinates[i.geometry.coordinates.length-1]):this.addClickSequence(e);const s={type:"Point",coordinates:o[o.length-1]},r=(0,de.A)(s,n);if(o.length>1&&i&&!r){this.resetClickSequence();if(0===(0,ce.A)(i,n).features.length)return;const e=this.splitPolygon(i,t);e&&t.onEdit(e)}}handlePointerMove(e,t){t.onUpdateCursor("cell")}splitPolygon(e,t){const i=this.getSelectedGeometry(t),n=t.selectedIndexes[0],o=t.modeConfig||{};let{gap:s=.1,units:l="centimeters"}=o;0===s&&(s=.1,l="centimeters");const d=(0,r.A)(e,s,{units:l}),c=(0,a.A)(i,d);if(!c)return console.warn("Canceling edit. Split Polygon erased"),null;const{type:p,coordinates:h}=c.geometry;let g=[];g="Polygon"===p?h.map(e=>[e]):h.reduce((e,t)=>(t.forEach(t=>{e.push([t])}),e),[]);return{updatedData:new z(t.data).replaceGeometry(n,{type:"MultiPolygon",coordinates:g}).getObject(),editType:"split",editContext:{featureIndexes:[n]}}}}class ge extends te{constructor(){super(...arguments),this.isPointAdded=!1}handleDragging(e,t){const i=T(e.pointerDownPicks);if(i){const{featureIndex:n}=i.properties;let{positionIndexes:o}=i.properties;const s=this.coordinatesSize(o,n,t.data);o=this.isPointAdded?this.nextPositionIndexes(o,s):o;const r=this.getPointForPositionIndexes(this.prevPositionIndexes(o,s),n,t.data),a=this.getPointForPositionIndexes(o,n,t.data);if(r&&a){const[i,l]=j(r,a,e.mapCoords),d=new z(t.data).replacePosition(n,this.prevPositionIndexes(o,s),l).replacePosition(n,o,i).getObject();t.onEdit({updatedData:d,editType:"extruding",editContext:{featureIndexes:[n],positionIndexes:this.nextPositionIndexes(o,s),position:i}}),e.cancelPan()}}}handleStartDragging(e,t){H(e)&&e.cancelPan();const i=t.selectedIndexes,n=E(e.picks);if(i.length&&n){const{positionIndexes:e,featureIndex:i}=n.properties,o=this.coordinatesSize(e,i,t.data),s=this.getPointForPositionIndexes(this.prevPositionIndexes(e,o),i,t.data),r=this.getPointForPositionIndexes(e,i,t.data);if(s&&r){let n=new z(t.data);this.isOrthogonal(e,i,o,t.data)||(n=n.addPosition(i,e,r)),this.isOrthogonal(this.prevPositionIndexes(e,o),i,o,t.data)||(n=n.addPosition(i,e,s),this.isPointAdded=!0),t.onEdit({updatedData:n.getObject(),editType:"startExtruding",editContext:{featureIndexes:[i],positionIndexes:e,position:s}})}}}handleStopDragging(e,t){const i=t.selectedIndexes,n=T(e.pointerDownPicks);if(i.length&&n){const{featureIndex:i}=n.properties;let{positionIndexes:o}=n.properties;const s=this.coordinatesSize(o,i,t.data);o=this.isPointAdded?this.nextPositionIndexes(o,s):o;const r=this.getPointForPositionIndexes(this.prevPositionIndexes(o,s),i,t.data),a=this.getPointForPositionIndexes(o,i,t.data);if(r&&a){const[n,l]=j(r,a,e.mapCoords),d=new z(t.data).replacePosition(i,this.prevPositionIndexes(o,s),l).replacePosition(i,o,n).getObject();t.onEdit({updatedData:d,editType:"extruded",editContext:{featureIndexes:[i],positionIndexes:o,position:n}})}}this.isPointAdded=!1}coordinatesSize(e,t,i){let{features:n}=i,o=0;if(Array.isArray(e)){const i=n[t].geometry.coordinates;if(3===e.length){const[t,n]=e;i.length&&i[t].length&&(o=i[t][n].length)}else{const[t]=e;i.length&&i[t].length&&(o=i[t].length)}}return o}getBearing(e,t){const i=(0,h.A)(e,t);return i<0?Math.floor(360+i):Math.floor(i)}isOrthogonal(e,t,i,n){if(!Array.isArray(e))return!1;e[e.length-1]===i-1&&(e[e.length-1]=0);const o=this.getPointForPositionIndexes(this.prevPositionIndexes(e,i),t,n),s=this.getPointForPositionIndexes(this.nextPositionIndexes(e,i),t,n),r=this.getPointForPositionIndexes(e,t,n),a=this.getBearing(r,o),l=this.getBearing(r,s);return[89,90,91,269,270,271].includes(Math.abs(a-l))}nextPositionIndexes(e,t){if(!Array.isArray(e))return[];const i=[...e];return i.length&&(i[i.length-1]=i[i.length-1]===t-1?0:i[i.length-1]+1),i}prevPositionIndexes(e,t){if(!Array.isArray(e))return[];const i=[...e];return i.length&&(i[i.length-1]=0===i[i.length-1]?t-2:i[i.length-1]-1),i}getPointForPositionIndexes(e,t,i){let n,{features:o}=i;if(Array.isArray(e)){const i=o[t].geometry.coordinates;if(3===e.length){const[t,o,s]=e;i.length&&i[t].length&&(n=i[t][o][s])}else{const[t,o]=e;i.length&&i[t].length&&(n=i[t][o])}}return n}}function ue(e){let{pointerDownScreenCoords:t,screenCoords:i}=e;return 10*(t[1]-i[1])}class me extends te{makeElevatedEvent(e,t,i){const{minElevation:n=0,maxElevation:o=2e4,calculateElevationChange:s=ue}=i.modeConfig||{};if(!e.pointerDownScreenCoords)return e;let r=3===t.length?t[2]:0;return r+=s({pointerDownScreenCoords:e.pointerDownScreenCoords,screenCoords:e.screenCoords}),r=Math.min(r,o),r=Math.max(r,n),Object.assign({},e,{mapCoords:[t[0],t[1],r]})}handlePointerMove(e,t){const i=T(e.pointerDownPicks),n=i?i.geometry.coordinates:e.mapCoords;super.handlePointerMove(this.makeElevatedEvent(e,n,t),t)}handleStopDragging(e,t){const i=T(e.picks),n=i?i.geometry.coordinates:e.mapCoords;super.handleStopDragging(this.makeElevatedEvent(e,n,t),t)}getCursor(e){let t=super.getCursor(e);return"cell"===t&&(t="ns-resize"),t}static calculateElevationChangeWithViewport(e,t){let{pointerDownScreenCoords:i,screenCoords:n}=t;return 156543.03392*Math.cos(e.latitude*Math.PI/180)/Math.pow(2,e.zoom)*(i[1]-n[1])/2}}class fe extends J{createTentativeFeature(e){const{lastPointerMoveEvent:t}=e;return{type:"Feature",properties:{guideType:"tentative"},geometry:{type:"Point",coordinates:(t?[t.mapCoords]:[])[0]}}}handleClick(e,t){let{mapCoords:i}=e;const n={type:"Point",coordinates:i};t.onEdit(this.getAddFeatureAction(n,t.data))}handlePointerMove(e,t){t.onUpdateCursor("cell"),super.handlePointerMove(e,t)}}function ye(e,t){if(e===t)return!0;if(Array.isArray(e)){const i=e.length;if(!t||t.length!==i)return!1;for(let n=0;n<i;n++)if(e[n]!==t[n])return!1;return!0}return!1}function xe(e){let t,i={};return n=>{for(const o in n)if(!ye(n[o],i[o])){t=e(n),i=n;break}return t}}class Ce extends J{constructor(){super(...arguments),this.dist=0,this.position=null,this.elems=[],this._getTooltips=xe(e=>{let{modeConfig:t,dist:i}=e,n=[];const{formatTooltip:o}=t||{};let s;return i&&(s=o?o(i):"Distance: "+parseFloat(i).toFixed(2)+" kilometers",n=[{position:this.position,text:s}]),n})}handleClick(e,t){const{picks:i}=e,n=T(i);let o=!1;n||(this.addClickSequence(e),o=!0);const s=this.getClickSequence();if(n||this.calculateInfoDraw(s),s.length>1&&n&&Array.isArray(n.properties.positionIndexes)&&n.properties.positionIndexes[0]===s.length-1){this.dist=0;const e={type:"LineString",coordinates:[...s]};this.resetClickSequence();const i=this.getAddFeatureAction(e,t.data);i&&t.onEdit(i)}else o&&t.onEdit({updatedData:t.data,editType:"addTentativePosition",editContext:{position:e.mapCoords}})}handleKeyUp(e,t){const{key:i}=e;if("Enter"===i){const e=this.getClickSequence();if(e.length>1){const i={type:"LineString",coordinates:[...e]};this.resetClickSequence();const n=this.getAddFeatureAction(i,t.data);n&&t.onEdit(n)}}else"Escape"===i&&(this.resetClickSequence(),t.onEdit({updatedData:t.data,editType:"cancelFeature",editContext:{}}))}getGuides(e){const{lastPointerMoveEvent:t}=e,i=this.getClickSequence(),n=t?[t.mapCoords]:[],o={type:"FeatureCollection",features:[]};let s;i.length>0&&(s={type:"Feature",properties:{guideType:"tentative"},geometry:{type:"LineString",coordinates:[...i,...n]}}),s&&o.features.push(s);const r=i.map((e,t)=>({type:"Feature",properties:{guideType:"editHandle",editHandleType:"existing",featureIndex:-1,positionIndexes:[t]},geometry:{type:"Point",coordinates:e}}));return o.features.push(...r),o}handlePointerMove(e,t){t.onUpdateCursor("cell")}getTooltips(e){return this._getTooltips({modeConfig:e.modeConfig,dist:this.dist})}calculateInfoDraw(e){e.length>1&&(this.position=e[e.length-1],this.dist+=(0,l.A)(e[e.length-2],e[e.length-1]))}}class ve extends J{createTentativeFeature(e){const{lastPointerMoveEvent:t}=e,i=this.getClickSequence(),n=t?[t.mapCoords]:[];let o;return 1===i.length||2===i.length?o={type:"Feature",properties:{guideType:"tentative"},geometry:{type:"LineString",coordinates:[...i,...n]}}:i.length>2&&(o={type:"Feature",properties:{guideType:"tentative"},geometry:{type:"Polygon",coordinates:[[...i,...n,i[0]]]}}),o}getGuides(e){const t=this.getClickSequence(),i={type:"FeatureCollection",features:[]},n=this.createTentativeFeature(e);n&&i.features.push(n);const o=t.map((e,t)=>({type:"Feature",properties:{guideType:"editHandle",editHandleType:"existing",featureIndex:-1,positionIndexes:[t]},geometry:{type:"Point",coordinates:e}}));return i.features.push(...o),i}handleClick(e,t){const{picks:i}=e,o=T(i),s=this.getClickSequence();let r=!1;if(s.length>2&&t.modeConfig&&t.modeConfig.preventOverlappingLines){const t=(0,n.wi)([s[s.length-1],e.mapCoords]),i=(0,n.wi)([...s.slice(0,s.length-1)]);(0,ce.A)(t,i).features.length>0&&(r=!0)}let a=!1;if(o||r||(this.addClickSequence(e),a=!0),s.length>2&&o&&Array.isArray(o.properties.positionIndexes)&&(0===o.properties.positionIndexes[0]||o.properties.positionIndexes[0]===s.length-1)){const e={type:"Polygon",coordinates:[[...s,s[0]]]};this.resetClickSequence();const i=this.getAddFeatureOrBooleanPolygonAction(e,t);i&&t.onEdit(i)}else a&&t.onEdit({updatedData:t.data,editType:"addTentativePosition",editContext:{position:e.mapCoords}})}handleKeyUp(e,t){if("Enter"===e.key){const e=this.getClickSequence();if(e.length>2){const i={type:"Polygon",coordinates:[[...e,e[0]]]};this.resetClickSequence();const n=this.getAddFeatureOrBooleanPolygonAction(i,t);n&&t.onEdit(n)}}else"Escape"===e.key&&(this.resetClickSequence(),t.onEdit({updatedData:t.data,editType:"cancelFeature",editContext:{}}))}handlePointerMove(e,t){t.onUpdateCursor("cell"),super.handlePointerMove(e,t)}}var be=i(7563),Pe=i.n(be);class Se extends J{handleClick(e,t){t.modeConfig&&t.modeConfig.dragToDraw||(this.addClickSequence(e),this.checkAndFinishPolygon(t))}handleStartDragging(e,t){t.modeConfig&&t.modeConfig.dragToDraw&&(this.addClickSequence(e),e.cancelPan())}handleStopDragging(e,t){t.modeConfig&&t.modeConfig.dragToDraw&&(this.addClickSequence(e),this.checkAndFinishPolygon(t))}checkAndFinishPolygon(e){const t=this.getClickSequence(),i=this.getTentativeGuide(e);if(t.length>1&&i&&"Polygon"===i.geometry.type){const t={type:"Feature",properties:Pe()(i.properties,"guideType"),geometry:{type:"Polygon",coordinates:i.geometry.coordinates}},n=this.getAddFeatureOrBooleanPolygonAction(t,e);this.resetClickSequence(),n&&e.onEdit(n)}}getGuides(e){const{lastPointerMoveEvent:t,modeConfig:i}=e,n=this.getClickSequence(),o={type:"FeatureCollection",features:[]};if(0===n.length||!t)return o;const s=n[0],r=t.mapCoords,a=this.getTwoClickPolygon(s,r,i);return a&&o.features.push({type:"Feature",properties:Object.assign({},a.properties,{guideType:"tentative"}),geometry:a.geometry}),o}getTwoClickPolygon(e,t,i){return null}handlePointerMove(e,t){t.onUpdateCursor("cell"),super.handlePointerMove(e,t)}createTentativeFeature(e){const{lastPointerMoveEvent:t}=e,i=this.getClickSequence(),n=t?[t.mapCoords]:[];let o;return 1===i.length&&(o=this.getTwoClickPolygon(i[0],n[0],e.modeConfig)),o}}class we extends Se{getTwoClickPolygon(e,t,i){const n=(0,s.A)([e[0],e[1],t[0],t[1]]);return n.properties=n.properties||{},n.properties.shape="Rectangle",n}}var ke=i(491);class Ae extends Se{getTwoClickPolygon(e,t,i){const o=[t[0],e[1]],r=[e[0],t[1]],a=(0,l.A)((0,n.zx)(o),(0,n.zx)(e)),d=(0,l.A)((0,n.zx)(r),(0,n.zx)(e)),c=a<=d?a:d,p=a<=d?o:r,h=(0,n.wi)([p,t]),g=(0,ke.A)(h,c).geometry.coordinates,u=(0,s.A)([e[0],e[1],g[0],g[1]]);return u.properties=u.properties||{},u.properties.shape="Square",u}}class je extends Se{getTwoClickPolygon(e,t,i){const n=e[0]>t[0]?e[0]+Math.abs(e[0]-t[0]):e[0]-Math.abs(e[0]-t[0]),o=e[1]>t[1]?e[1]+Math.abs(e[1]-t[1]):e[1]-Math.abs(e[1]-t[1]),r=(0,s.A)([n,o,t[0],t[1]]);return r.properties=r.properties||{},r.properties.shape="Rectangle",r}}class Me extends Se{getTwoClickPolygon(e,t,i){const o=[t[0],e[1]],r=[e[0],t[1]],a=(0,l.A)((0,n.zx)(o),(0,n.zx)(e)),d=(0,l.A)((0,n.zx)(r),(0,n.zx)(e)),c=a<=d?a:d,p=a<=d?o:r,h=(0,n.wi)([p,t]),g=(0,ke.A)(h,c).geometry.coordinates,u=e[0]>g[0]?e[0]+Math.abs(e[0]-g[0]):e[0]-Math.abs(e[0]-g[0]),m=e[1]>g[1]?e[1]+Math.abs(e[1]-g[1]):e[1]-Math.abs(e[1]-g[1]),f=(0,s.A)([u,m,g[0],g[1]]);return f.properties=f.properties||{},f.properties.shape="Square",f}}var Fe=i(6338),Te=i(999);class De extends Se{constructor(){super(...arguments),this.radius=null,this.position=null,this.areaCircle=null,this._getTooltips=xe(e=>{let{modeConfig:t,radius:i,areaCircle:n}=e,o=[];const{formatTooltip:s}=t||{};let r;return i&&n&&(r=s?s(i):"Radius: "+parseFloat(i).toFixed(2)+" kilometers\n      \n Area: "+parseFloat(n).toFixed(2),o=[{position:this.position,text:r}]),o})}getTwoClickPolygon(e,t,i){const{steps:n=64}=i||{},o={steps:n};this.position=t,n<4&&(console.warn("Minimum steps to draw a circle is 4 "),o.steps=4),this.radius=Math.max((0,l.A)(e,t),.001);const s=(0,Fe.A)(e,this.radius,o);return s.properties=s.properties||{},s.properties.shape="Circle",s.properties.editProperties=s.properties.editProperties||{},s.properties.editProperties.shape="Circle",s.properties.editProperties.radius={value:this.radius,unit:"kilometers"},s.properties.editProperties.center=e,this.areaCircle=(0,Te.A)(s),s}getTooltips(e){return this._getTooltips({modeConfig:null==e?void 0:e.modeConfig,radius:this.radius,areaCircle:this.areaCircle})}}class Ee extends Se{constructor(){super(...arguments),this.radius=null,this.position=null,this.areaCircle=null,this.diameter=null,this._getTooltips=xe(e=>{let{modeConfig:t,radius:i,areaCircle:n,diameter:o}=e,s=[];const{formatTooltip:r}=t||{};let a;return i&&n&&(a=r?r(i):"Radius: "+parseFloat(i).toFixed(2)+" kilometers\n      \n Area: "+parseFloat(n).toFixed(2)+"\n      \n Diameter: "+parseFloat(o).toFixed(2)+" kilometers",s=[{position:this.position,text:a}]),s})}getTwoClickPolygon(e,t,i){const{steps:n=64}=i||{},o={steps:n};n<4&&(console.warn("Minimum steps to draw a circle is 4 "),o.steps=4);const s=V(e,t);this.radius=Math.max((0,l.A)(e,s),.001),this.diameter=Math.max((0,l.A)(e,t),.001),this.position=s;const r=(0,Fe.A)(s,this.radius,o);return r.properties=r.properties||{},r.properties.shape="Circle",r.properties.editProperties=r.properties.editProperties||{},r.properties.editProperties.shape="Circle",r.properties.editProperties.radius={value:this.radius,unit:"kilometers"},r.properties.editProperties.center=s,this.areaCircle=(0,Te.A)(r),r}getTooltips(e){return this._getTooltips({modeConfig:e.modeConfig,radius:this.radius,areaCircle:this.areaCircle,diameter:this.diameter})}}var Ie=i(3416);class _e extends Se{getTwoClickPolygon(e,t,i){const o=Math.min(e[0],t[0]),r=Math.min(e[1],t[1]),a=Math.max(e[0],t[0]),d=Math.max(e[1],t[1]),c=(0,s.A)([o,r,a,d]).geometry.coordinates[0],p=V(e,t),h=Math.max((0,l.A)((0,n.zx)(c[0]),(0,n.zx)(c[1])),.001),g=Math.max((0,l.A)((0,n.zx)(c[0]),(0,n.zx)(c[3])),.001),u=(0,Ie.A)(p,h,g);return u.properties=u.properties||{},u.properties.editProperties=u.properties.editProperties||{},u.properties.editProperties.shape="Ellipse",u.properties.editProperties.xSemiAxis={value:h,unit:"kilometers"},u.properties.editProperties.ySemiAxis={value:g,unit:"kilometers"},u.properties.editProperties.angle=0,u.properties.editProperties.center=p,u}}class Le extends J{handleClick(e,t){this.addClickSequence(e);const i=this.getClickSequence(),n=this.getTentativeGuide(t);if(i.length>2&&n&&"Polygon"===n.geometry.type){const e=this.getAddFeatureOrBooleanPolygonAction(n.geometry,t,Pe()(n.properties,"guideType"));this.resetClickSequence(),e&&t.onEdit(e)}}getGuides(e){const{lastPointerMoveEvent:t,modeConfig:i}=e,n=this.getClickSequence(),o={type:"FeatureCollection",features:[]};if(0===n.length)return o;const s=t.mapCoords;if(1===n.length)o.features.push({type:"Feature",properties:{guideType:"tentative"},geometry:{type:"LineString",coordinates:[n[0],s]}});else{const e=this.getThreeClickPolygon(n[0],n[1],s,i);e&&o.features.push({type:"Feature",properties:Object.assign({},e.properties,{guideType:"tentative"}),geometry:e.geometry})}return o}getThreeClickPolygon(e,t,i,n){return null}handlePointerMove(e,t){t.onUpdateCursor("cell"),super.handlePointerMove(e,t)}createTentativeFeature(e){const{lastPointerMoveEvent:t}=e,i=this.getClickSequence(),n=t?[t.mapCoords]:[];let o;return 2===i.length&&(o=this.getThreeClickPolygon(i[0],i[1],n[0],e.modeConfig)),o}}class Oe extends Le{getThreeClickPolygon(e,t,i,n){const[o,s]=j(e,t,i);return{type:"Feature",properties:{shape:"Rectangle"},geometry:{type:"Polygon",coordinates:[[e,t,o,s,e]]}}}}class He extends Le{getThreeClickPolygon(e,t,i,o){const s=V(e,t),r=Math.max((0,l.A)(s,(0,n.zx)(i)),.001),a=Math.max((0,l.A)(e,t),.001)/2,d={angle:(0,h.A)(e,t)},c=(0,Ie.A)(s,r,a,d);return c.properties=c.properties||{},c.properties.editProperties=c.properties.editProperties||{},c.properties.editProperties.shape="Ellipse",c.properties.editProperties.xSemiAxis={value:r,unit:"kilometers"},c.properties.editProperties.ySemiAxis={value:a,unit:"kilometers"},c.properties.editProperties.angle=d.angle,c.properties.editProperties.center=s,c}}class ze extends J{createTentativeFeature(e){const t=this.getClickSequence(),{mapCoords:i}=e.lastPointerMoveEvent;let n,o;if(t.length<=1)n=i;else{const e=t[t.length-2],o=t[t.length-1];[n]=j(e,o,i)}return o=t.length<3?{type:"Feature",properties:{guideType:"tentative"},geometry:{type:"LineString",coordinates:[...t,n]}}:{type:"Feature",properties:{guideType:"tentative"},geometry:{type:"Polygon",coordinates:[[...t,n,t[0]]]}},o}getGuides(e){const t={type:"FeatureCollection",features:[]};if(0===this.getClickSequence().length||!e.lastPointerMoveEvent)return t;const i=this.createTentativeFeature(e);return t.features.push(i),t.features=t.features.concat(_(i.geometry,-1)),t.features=t.features.slice(0,-1),t}handlePointerMove(e,t){t.onUpdateCursor("cell"),super.handlePointerMove(e,t)}handleClick(e,t){const{picks:i}=e,n=this.getTentativeGuide(t);this.addClickSequence(e);const o=this.getClickSequence();if(n)if(3===o.length&&"LineString"===n.geometry.type){const e=n.geometry;o[o.length-1]=e.coordinates[e.coordinates.length-1]}else if(o.length>3&&"Polygon"===n.geometry.type){const e=n.geometry;o[o.length-1]=e.coordinates[0][e.coordinates[0].length-2];const s=T(i);if(s&&Array.isArray(s.properties.positionIndexes)&&(0===s.properties.positionIndexes[1]||s.properties.positionIndexes[1]===e.coordinates[0].length-3)){const i={type:"Polygon",coordinates:this.finalizedCoordinates([...e.coordinates[0]])};this.resetClickSequence();const n=this.getAddFeatureOrBooleanPolygonAction(i,t);n&&t.onEdit(n)}}else{const i={screenCoords:[-1,-1],mapCoords:e.mapCoords,picks:[],pointerDownPicks:null,pointerDownScreenCoords:null,pointerDownMapCoords:null,cancelPan:()=>{},sourceEvent:null};this.handlePointerMove(i,t)}}finalizedCoordinates(e){let t=[[...e.slice(0,-2),e[0]]],i=this.getIntermediatePoint([...e]);if(i)t=[[...e.slice(0,-2),i,e[0]]];else{const n=[...e];n.splice(-3,1),i=this.getIntermediatePoint([...n]),i&&(t=[[...e.slice(0,-3),i,e[0]]])}return t}getIntermediatePoint(e){let t=null;if(e.length>4){const[i,o]=[...e],s=(0,h.A)(i,o),r=e[e.length-3],a=e[e.length-4],d=(0,h.A)(r,a),c={first:[],second:[]};[1,2,3].forEach(e=>{const t=s+90*e;c.first.push(t>180?t-360:t);const i=d+90*e;c.second.push(i>180?i-360:i)});const g=(0,l.A)((0,n.zx)(i),(0,n.zx)(r));[0,1,2].forEach(e=>{const o=(0,n.wi)([i,(0,p.A)(i,g,c.first[e]).geometry.coordinates]);[0,1,2].forEach(e=>{const i=(0,n.wi)([r,(0,p.A)(r,g,c.second[e]).geometry.coordinates]),s=(0,ce.A)(o,i);s&&s.features.length&&(t=s.features[0].geometry.coordinates)})})}return t}}var Re=i(8550),Ne=i.n(Re);class qe extends ve{constructor(){super(...arguments),this.handleDraggingThrottled=null}handleClick(e,t){}handleStartDragging(e,t){e.cancelPan(),t.modeConfig&&t.modeConfig.throttleMs?this.handleDraggingThrottled=Ne()(this.handleDraggingAux,t.modeConfig.throttleMs):this.handleDraggingThrottled=this.handleDraggingAux}handleStopDragging(e,t){this.addClickSequence(e);const i=this.getClickSequence();if(this.handleDraggingThrottled&&this.handleDraggingThrottled.cancel&&this.handleDraggingThrottled.cancel(),i.length>2){const e={type:"Polygon",coordinates:[[...i,i[0]]]},n=this.getAddFeatureOrBooleanPolygonAction(e,t);n&&t.onEdit(n)}this.resetClickSequence()}handleDraggingAux(e,t){const{picks:i}=e;T(i)||(this.addClickSequence(e),t.onEdit({updatedData:t.data,editType:"addTentativePosition",editContext:{position:e.mapCoords}}))}handleDragging(e,t){this.handleDraggingThrottled&&this.handleDraggingThrottled(e,t)}handleKeyUp(e,t){if("Enter"===e.key){const e=this.getClickSequence();if(e.length>2){const i={type:"Polygon",coordinates:[[...e,e[0]]]};this.resetClickSequence();const n=this.getAddFeatureOrBooleanPolygonAction(i,t);n&&t.onEdit(n)}}else"Escape"===e.key&&(this.resetClickSequence(),this.handleDraggingThrottled&&(this.handleDraggingThrottled=null),t.onEdit({updatedData:t.data,editType:"cancelFeature",editContext:{}}))}}class Ge extends J{constructor(e){super(),this._handler=e}_getSnappedMouseEvent(e,t,i){return Object.assign(e,{mapCoords:i.geometry.coordinates,pointerDownMapCoords:t&&t.geometry.coordinates})}_getPickedSnapTarget(e){return I(e).find(e=>"snap-target"===e.properties.editHandleType)}_getPickedSnapSource(e){return I(e).find(e=>"snap-source"===e.properties.editHandleType)}_getUpdatedSnapSourceHandle(e,t){const{featureIndex:i,positionIndexes:n}=e.properties;if(!Array.isArray(n))return e;const o=t.features[i],s=n.reduce((e,t)=>e[t],o.geometry.coordinates);return Object.assign({},e,{geometry:{type:"Point",coordinates:s}})}_getSnapTargets(e){let{additionalSnapTargets:t}=e.modeConfig||{};t=t||[];return[...e.data.features,...t]}_getSnapTargetHandles(e){const t=[],i=this._getSnapTargets(e);for(let n=0;n<i.length;n++){if(!e.selectedIndexes.includes(n)){const{geometry:e}=i[n];t.push(..._(e,n,"snap-target"))}}return t}getGuides(e){const{modeConfig:t,lastPointerMoveEvent:i}=e,{enableSnapping:n}=t||{},o={type:"FeatureCollection",features:[...this._handler.getGuides(e).features]};if(!n)return o;const s=i&&this._getPickedSnapSource(i.pointerDownPicks);if(s)return o.features.push(...this._getSnapTargetHandles(e),this._getUpdatedSnapSourceHandle(s,e.data)),o;const{features:r}=e.data;for(const a of e.selectedIndexes)if(a<r.length){const{geometry:e}=r[a];o.features.push(..._(e,a,"snap-source"))}return o}_getSnapAwareEvent(e,t){const i=this._getPickedSnapSource(t.lastPointerMoveEvent.pointerDownPicks),n=this._getPickedSnapTarget(e.picks);return i&&n?this._getSnappedMouseEvent(e,i,n):e}handleStartDragging(e,t){this._handler.handleStartDragging(e,t)}handleStopDragging(e,t){this._handler.handleStopDragging(this._getSnapAwareEvent(e,t),t)}handleDragging(e,t){this._handler.handleDragging(this._getSnapAwareEvent(e,t),t)}handlePointerMove(e,t){this._handler.handlePointerMove(this._getSnapAwareEvent(e,t),t)}}class Ue extends J{constructor(e){super(),this._modes=e}_coalesce(e,t){void 0===t&&(t=null);let i=null;for(let n=0;n<this._modes.length&&(i=e(this._modes[n]),!(t?t(i):i));n++);return i}handleClick(e,t){this._coalesce(i=>i.handleClick(e,t))}handlePointerMove(e,t){return this._coalesce(i=>i.handlePointerMove(e,t))}handleStartDragging(e,t){return this._coalesce(i=>i.handleStartDragging(e,t))}handleStopDragging(e,t){return this._coalesce(i=>i.handleStopDragging(e,t))}handleDragging(e,t){return this._coalesce(i=>i.handleDragging(e,t))}getGuides(e){const t=[];for(const i of this._modes)t.push(...i.getGuides(e).features);return{type:"FeatureCollection",features:t}}}class Be extends Ue{constructor(){super([new ee,new se,new ae])}handlePointerMove(e,t){let i=null;super.handlePointerMove(e,Object.assign({},t,{onUpdateCursor:e=>{i=e||i}})),t.onUpdateCursor(i)}handleStartDragging(e,t){let i=null,n=null;const o=[];e.picks.length&&e.cancelPan(),this._modes.forEach(e=>{e instanceof ee?n=e:(e instanceof se&&(i=e),o.push(e))}),i instanceof se&&!i.isEditHandleSelected()&&o.push(n),o.filter(Boolean).forEach(i=>i.handleStartDragging(e,t))}getGuides(e){let t=super.getGuides(e);const i=(this._modes||[]).find(e=>e instanceof ae);if(i instanceof ae){const e=t.features.filter(e=>{const{editHandleType:t,mode:n}=e.properties||{},o=[n];return i.getIsRotating()&&o.push(t),!o.includes("scale")});t=(0,n.Lr)(e)}return t}}const We=2/3,Je=["click","pointermove","panstart","panmove","panend","keyup"];class Ve extends m.A{constructor(){super(...arguments),this.state=void 0}onLayerClick(e){}onStartDragging(e){}onStopDragging(e){}onDragging(e){}onPointerMove(e){}onLayerKeyUp(e){}initializeState(){this.setState({_editableLayerState:{pointerDownPicks:null,pointerDownScreenCoords:null,pointerDownMapCoords:null,eventHandler:this._forwardEventToCurrentLayer.bind(this)}}),this._addEventHandlers()}finalizeState(){this._removeEventHandlers()}_addEventHandlers(){const{eventManager:e}=this.context.deck,{eventHandler:t}=this.state._editableLayerState;for(const i of Je)e.on(i,t,{priority:100})}_removeEventHandlers(){const{eventManager:e}=this.context.deck,{eventHandler:t}=this.state._editableLayerState;for(const i of Je)e.off(i,t)}_forwardEventToCurrentLayer(e){const t=this.getCurrentLayer(),i=t["_on"+e.type].bind(t);i?i(e):console.warn("no handler for mjolnir.js event "+e.type)}_onclick(e){let{srcEvent:t}=e;const i=this.getScreenCoords(t),n=this.getMapCoords(i),o=this.getPicks(i);this.onLayerClick({mapCoords:n,screenCoords:i,picks:o,sourceEvent:t})}_onkeyup(e){let{srcEvent:t}=e;this.onLayerKeyUp(t)}_onpanstart(e){const t=this.getScreenCoords(e.srcEvent),i=this.getMapCoords(t),n=this.getPicks(t);this.setState({_editableLayerState:Object.assign({},this.state._editableLayerState,{pointerDownScreenCoords:t,pointerDownMapCoords:i,pointerDownPicks:n})}),this.onStartDragging({picks:n,screenCoords:t,mapCoords:i,pointerDownScreenCoords:t,pointerDownMapCoords:i,cancelPan:()=>{this.props.onCancelPan&&this.props.onCancelPan(),e.stopImmediatePropagation()},sourceEvent:e.srcEvent})}_onpanmove(e){const{srcEvent:t}=e,i=this.getScreenCoords(t),n=this.getMapCoords(i),{pointerDownPicks:o,pointerDownScreenCoords:s,pointerDownMapCoords:r}=this.state._editableLayerState,a=this.getPicks(i);this.onDragging({screenCoords:i,mapCoords:n,picks:a,pointerDownPicks:o,pointerDownScreenCoords:s,pointerDownMapCoords:r,sourceEvent:t,cancelPan:e.stopImmediatePropagation})}_onpanend(e){let{srcEvent:t}=e;const i=this.getScreenCoords(t),n=this.getMapCoords(i),{pointerDownPicks:o,pointerDownScreenCoords:s,pointerDownMapCoords:r}=this.state._editableLayerState,a=this.getPicks(i);this.onStopDragging({picks:a,screenCoords:i,mapCoords:n,pointerDownPicks:o,pointerDownScreenCoords:s,pointerDownMapCoords:r,sourceEvent:t}),this.setState({_editableLayerState:Object.assign({},this.state._editableLayerState,{pointerDownScreenCoords:null,pointerDownMapCoords:null,pointerDownPicks:null})})}_onpointermove(e){const{srcEvent:t}=e,i=this.getScreenCoords(t),n=this.getMapCoords(i),{pointerDownPicks:o,pointerDownScreenCoords:s,pointerDownMapCoords:r}=this.state._editableLayerState,a=this.getPicks(i);this.onPointerMove({screenCoords:i,mapCoords:n,picks:a,pointerDownPicks:o,pointerDownScreenCoords:s,pointerDownMapCoords:r,sourceEvent:t,cancelPan:e.stopImmediatePropagation})}getPicks(e){return this.context.deck.pickMultipleObjects({x:e[0],y:e[1],layerIds:[this.props.id],radius:this.props.pickingRadius,depth:this.props.pickingDepth})}getScreenCoords(e){return[e.clientX-this.context.gl.canvas.getBoundingClientRect().left,e.clientY-this.context.gl.canvas.getBoundingClientRect().top]}getMapCoords(e){return this.context.viewport.unproject([e[0],e[1]])}}Ve.layerName="EditableLayer";var Ke=i(4968);const Ze="uniform pickingLineWidthUniforms {\n  float extraPixels;\n} pickingLineWidth;\n",Xe={name:"pickingLineWidth",vs:Ze,fs:Ze,uniformTypes:{extraPixels:"f32"}},Qe=Object.assign({},Ke.A.defaultProps,{pickingLineWidthExtraPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER}});class Ye extends Ke.A{getShaders(){const e=super.getShaders();return e.vs=function(e,t,i){const n=e.indexOf(t);return n<0?e:e.slice(0,n)+i+e.slice(n)}(e.vs,"vec3 width;","\n       if(bool(picking.isActive)){\n        widthPixels.xy += pickingLineWidth.extraPixels;\n       }\n      "),Object.assign({},e,{modules:[...e.modules,Xe]})}draw(e){const{pickingLineWidthExtraPixels:t}=this.props,i={extraPixels:t};this.state.model.shaderInputs.setProps({pickingLineWidth:i}),super.draw(e)}}Ye.defaultProps=Qe,Ye.layerName="EditablePathLayer";const $e=[0,0,0,153],et=[0,0,0,144],tt=[0,0,0,255],it=[0,0,144,144],nt=[144,144,144,255],ot=[144,144,144,144],st=[192,0,0,255],rt=[0,0,0,128],at=[124,0,192,255],lt=[255,255,255,255],dt=ve;function ct(e){return e&&"function"==typeof e?t=>e(function(e){if(e.__source)return e.__source.object;if(e.sourceFeature)return e.sourceFeature.feature;return e}(t)):e}function pt(e){switch(e.properties.editHandleType){case"existing":return st;case"snap-source":return at;default:return rt}}const ht={mode:dt,onEdit:()=>{},pickable:!0,pickingRadius:10,pickingDepth:5,fp64:!1,filled:!0,stroked:!0,lineWidthScale:We,lineWidthMinPixels:1,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,pickingLineWidthExtraPixels:0,lineWidthUnits:"pixels",lineJointRounded:!1,lineCapRounded:!1,lineMiterLimit:4,pointRadiusScale:1,pointRadiusMinPixels:2,pointRadiusMaxPixels:Number.MAX_SAFE_INTEGER,getLineColor:(e,t,i)=>t?tt:$e,getFillColor:(e,t,i)=>t?it:et,getRadius:e=>e&&e.properties&&e.properties.radius||e&&e.properties&&e.properties.size||1,getLineWidth:e=>e&&e.properties&&e.properties.lineWidth||3,getTentativeLineColor:e=>nt,getTentativeFillColor:e=>ot,getTentativeLineWidth:e=>e&&e.properties&&e.properties.lineWidth||3,editHandleType:"point",editHandlePointRadiusScale:1,editHandlePointOutline:!0,editHandlePointStrokeWidth:2,editHandlePointRadiusUnits:"pixels",editHandlePointRadiusMinPixels:4,editHandlePointRadiusMaxPixels:8,getEditHandlePointColor:pt,getEditHandlePointOutlineColor:function(e){return lt},getEditHandlePointRadius:function(e){switch(e.properties.editHandleType){case"existing":return 5;case"snap":return 7;default:return 3}},editHandleIconAtlas:null,editHandleIconMapping:null,editHandleIconSizeScale:1,editHandleIconSizeUnits:"pixels",getEditHandleIcon:e=>e.properties.editHandleType,getEditHandleIconSize:10,getEditHandleIconColor:pt,getEditHandleIconAngle:0,billboard:!0},gt={view:K,modify:te,translate:new Ge(new ee),transform:new Ge(new Be),scale:se,rotate:ae,duplicate:le,split:he,extrude:ge,elevation:me,delete:class extends J{handleClick(e,t){const i=t.lastPointerMoveEvent.picks.map(e=>e.index);if(i.length>0){const e=i[0],n=t.data.features.filter((t,i)=>i!==e),o={updatedData:Object.assign({},t.data,{features:n}),editType:"deleteFeature",editContext:{featureIndexes:i}};t.onEdit(o)}}},drawPoint:fe,drawLineString:Ce,drawPolygon:ve,drawRectangle:we,drawSquare:Ae,drawRectangleFromCenter:je,drawSquareFromCenter:Me,drawCircleFromCenter:De,drawCircleByBoundingBox:Ee,drawEllipseByBoundingBox:_e,drawRectangleUsing3Points:Oe,drawEllipseUsing3Points:He,draw90DegreePolygon:ze,drawPolygonByDragging:qe};class ut extends Ve{constructor(){super(...arguments),this.state=void 0}renderLayers(){const e=this.getSubLayerProps({id:"geojson",data:this.props.data,fp64:this.props.fp64,filled:this.props.filled,stroked:this.props.stroked,lineWidthScale:this.props.lineWidthScale,lineWidthMinPixels:this.props.lineWidthMinPixels,lineWidthMaxPixels:this.props.lineWidthMaxPixels,lineWidthUnits:this.props.lineWidthUnits,lineJointRounded:this.props.lineJointRounded,lineCapRounded:this.props.lineCapRounded,lineMiterLimit:this.props.lineMiterLimit,pointRadiusScale:this.props.pointRadiusScale,pointRadiusMinPixels:this.props.pointRadiusMinPixels,pointRadiusMaxPixels:this.props.pointRadiusMaxPixels,getLineColor:this.selectionAwareAccessor(this.props.getLineColor),getFillColor:this.selectionAwareAccessor(this.props.getFillColor),getPointRadius:this.selectionAwareAccessor(this.props.getRadius),getLineWidth:this.selectionAwareAccessor(this.props.getLineWidth),_subLayerProps:{linestrings:{billboard:this.props.billboard,updateTriggers:{all:[this.props.selectedFeatureIndexes,this.props.mode]}},"polygons-stroke":{billboard:this.props.billboard,pickingLineWidthExtraPixels:this.props.pickingLineWidthExtraPixels,type:Ye,updateTriggers:{all:[this.props.selectedFeatureIndexes,this.props.mode]}}},updateTriggers:{getLineColor:[this.props.selectedFeatureIndexes,this.props.mode],getFillColor:[this.props.selectedFeatureIndexes,this.props.mode],getPointRadius:[this.props.selectedFeatureIndexes,this.props.mode],getLineWidth:[this.props.selectedFeatureIndexes,this.props.mode]}});let t=[new C.A(e)];return t=t.concat(this.createGuidesLayers(),this.createTooltipsLayers()),t}initializeState(){super.initializeState(),this.setState({selectedFeatures:[],editHandles:[]})}shouldUpdateState(e){return super.shouldUpdateState(e)||e.changeFlags.stateChanged}updateState(e){let{props:t,oldProps:i,changeFlags:n,context:o}=e;if(super.updateState({oldProps:i,props:t,changeFlags:n,context:o}),n.propsOrDataChanged){if(0===Object.keys(i).length||t.mode!==i.mode){let e;if("function"==typeof t.mode){e=new(0,t.mode)}else"string"==typeof t.mode?(e=gt[t.mode],console.warn("Deprecated use of passing `mode` as a string. Pass the mode's class constructor instead.")):e=t.mode;e||(console.warn("No mode configured for "+String(t.mode)),e=new dt),e!==this.state.mode&&this.setState({mode:e,cursor:null})}}let s=[];if(Array.isArray(t.selectedFeatureIndexes)&&"object"==typeof t.data&&"features"in t.data){const e=t.data;s=t.selectedFeatureIndexes.map(t=>e.features[t])}this.setState({selectedFeatures:s})}getModeProps(e){return{modeConfig:e.modeConfig,data:e.data,selectedIndexes:e.selectedFeatureIndexes,lastPointerMoveEvent:this.state.lastPointerMoveEvent,cursor:this.state.cursor,onEdit:t=>{this.setNeedsUpdate(),e.onEdit(t)},onUpdateCursor:e=>{this.setState({cursor:e})}}}selectionAwareAccessor(e){return"function"!=typeof e?e:t=>e(t,this.isFeatureSelected(t),this.props.mode)}isFeatureSelected(e){return!(!this.props.data||!this.props.selectedFeatureIndexes)&&(!!this.props.selectedFeatureIndexes.length&&this.state.selectedFeatures.includes(e))}getPickingInfo(e){let{info:t,sourceLayer:i}=e;return i.id.endsWith("guides")&&(t.isGuide=!0),t}_updateAutoHighlight(e){if(null!=e&&e.sourceLayer)if(e.isGuide)for(const t of e.sourceLayer.getSubLayers())t.updateAutoHighlight(e);else e.sourceLayer.updateAutoHighlight(e)}createGuidesLayers(){const e=this.getActiveMode().getGuides(this.getModeProps(this.props));if(!e||!e.features.length)return[];const t={linestrings:{billboard:this.props.billboard,autoHighlight:!1},"polygons-fill":{autoHighlight:!1},"polygons-stroke":{billboard:this.props.billboard}};"icon"===this.props.editHandleType?t["points-icon"]={type:v.A,iconAtlas:this.props.editHandleIconAtlas,iconMapping:this.props.editHandleIconMapping,sizeUnits:this.props.editHandleIconSizeUnits,sizeScale:this.props.editHandleIconSizeScale,getIcon:ct(this.props.getEditHandleIcon),getSize:ct(this.props.getEditHandleIconSize),getColor:ct(this.props.getEditHandleIconColor),getAngle:ct(this.props.getEditHandleIconAngle),billboard:this.props.billboard}:t["points-circle"]={type:f.A,radiusScale:this.props.editHandlePointRadiusScale,stroked:this.props.editHandlePointOutline,getLineWidth:this.props.editHandlePointStrokeWidth,radiusUnits:this.props.editHandlePointRadiusUnits,radiusMinPixels:this.props.editHandlePointRadiusMinPixels,radiusMaxPixels:this.props.editHandlePointRadiusMaxPixels,getRadius:ct(this.props.getEditHandlePointRadius),getFillColor:ct(this.props.getEditHandlePointColor),getLineColor:ct(this.props.getEditHandlePointOutlineColor),billboard:this.props.billboard};return[new C.A(this.getSubLayerProps({id:"guides",data:e,fp64:this.props.fp64,_subLayerProps:t,lineWidthScale:this.props.lineWidthScale,lineWidthMinPixels:this.props.lineWidthMinPixels,lineWidthMaxPixels:this.props.lineWidthMaxPixels,lineWidthUnits:this.props.lineWidthUnits,lineJointRounded:this.props.lineJointRounded,lineCapRounded:this.props.lineCapRounded,lineMiterLimit:this.props.lineMiterLimit,getLineColor:ct(this.props.getTentativeLineColor),getLineWidth:ct(this.props.getTentativeLineWidth),getFillColor:ct(this.props.getTentativeFillColor),pointType:"icon"===this.props.editHandleType?"icon":"circle",iconAtlas:this.props.editHandleIconAtlas}))]}createTooltipsLayers(){const e=this.getActiveMode().getTooltips(this.getModeProps(this.props));return[new x.A(Object.assign({getSize:21.333333333333332},this.getSubLayerProps({id:"tooltips",data:e})))]}onLayerClick(e){this.getActiveMode().handleClick(e,this.getModeProps(this.props))}onLayerKeyUp(e){this.getActiveMode().handleKeyUp(e,this.getModeProps(this.props))}onStartDragging(e){this.getActiveMode().handleStartDragging(e,this.getModeProps(this.props))}onDragging(e){this.getActiveMode().handleDragging(e,this.getModeProps(this.props))}onStopDragging(e){this.getActiveMode().handleStopDragging(e,this.getModeProps(this.props))}onPointerMove(e){this.setState({lastPointerMoveEvent:e}),this.getActiveMode().handlePointerMove(e,this.getModeProps(this.props))}getCursor(e){let{isDragging:t}=e;if(null===this.state||void 0===this.state)return null;let{cursor:i}=this.state;return i||(i=t?"grabbing":"grab"),i}getActiveMode(){return this.state.mode}}ut.layerName="EditableGeoJsonLayer",ut.defaultProps=ht;var mt=i(4326);const ft=K,yt={type:"FeatureCollection",features:[]},xt=Object.assign({mode:ft},ut.defaultProps,{data:[],selectedIndexes:[],filled:!1,stroked:!0,lineWidthScale:We,lineWidthMinPixels:1,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineWidthUnits:"pixels",getHexagons:e=>e.hexIds,getEditedCluster:(e,t)=>t?Object.assign({},t,{hexIds:e}):{hexIds:e},resolution:9});class Ct extends Ve{constructor(){super(...arguments),this.state=void 0}initializeState(){super.initializeState(),this.setState({tentativeHexagonIDs:[]})}getDerivedHexagonIDs(e){throw new Error("not implemented")}getDerivedHexagonID(e){throw new Error("not implemented")}renderLayers(){return[new ut(this.getSubLayerProps({id:"editable-geojson",mode:this.props.mode,data:yt,selectedFeatureIndexes:[],onEdit:e=>{const{editType:t,editContext:i}=e;switch(t){case"updateTentativeFeature":if("Polygon"===i.feature.geometry.type){const e=i.feature.geometry.coordinates,t=this.getDerivedHexagonIDs(e);this.setState({tentativeHexagonIDs:t})}else if("Point"===i.feature.geometry.type){const e=i.feature.geometry.coordinates,t=this.getDerivedHexagonID(e);this.setState({tentativeHexagonIDs:[t]})}break;case"addFeature":const e=[...this.props.data],{modeConfig:t}=this.props;if(t&&t.booleanOperation)if(1!==this.props.selectedIndexes.length)console.warn("booleanOperation only supported for single cluster selection");else{let i;const n=new Set(this.getSelectedHexIDs()),o=new Set(this.state.tentativeHexagonIDs);switch(t.booleanOperation){case"union":default:i=[...new Set([...n,...o])];break;case"intersection":i=[...n].filter(e=>o.has(e));break;case"difference":i=[...n].filter(e=>!o.has(e))}const s=this.props.selectedIndexes[0],r=this.props.data[s];e[s]=this.props.getEditedCluster(i,r)}else e.push(this.props.getEditedCluster(this.state.tentativeHexagonIDs,null));this.setState({tentativeHexagonIDs:[]}),this.props.onEdit({updatedData:e})}}})),new mt.A(this.getSubLayerProps({id:"hexagons",data:this.props.data,getHexagons:this.props.getHexagons})),new mt.A(this.getSubLayerProps({id:"tentative-hexagons",data:[{hexIds:this.state.tentativeHexagonIDs}],getHexagons:e=>e.hexIds}))]}getSelectedHexIDs(){let e=[];return this.props.selectedIndexes.forEach(t=>{const i=this.props.data[t],n=this.props.getHexagons(i);e=e.concat(n)}),e}getCursor(e){let{isDragging:t}=e,{cursor:i}=this.state||{};return i||(i=t?"grabbing":"grab"),i}}Ct.layerName="EditableH3ClusterLayer",Ct.defaultProps=xt;var vt=i(9751);const bt="rectangle",Pt="polygon",St={[bt]:we,[Pt]:ve},wt={[bt]:{dragToDraw:!0}},kt={selectionType:bt,layerIds:[],onSelect:()=>{}},At={type:"FeatureCollection",features:[]},jt="selection-blocker",Mt=["lineWidthScale","lineWidthMinPixels","lineWidthMaxPixels","lineWidthUnits","lineJointRounded","lineCapRounded","lineMiterLimit","pointRadiusScale","pointRadiusMinPixels","pointRadiusMaxPixels","lineDashJustified","getLineColor","getFillColor","getRadius","getLineWidth","getLineDashArray","getTentativeLineDashArray","getTentativeLineColor","getTentativeFillColor","getTentativeLineWidth"];class Ft extends m.A{constructor(){super(...arguments),this.state=void 0}_selectRectangleObjects(e){const{layerIds:t,onSelect:i}=this.props,[n,o]=this.context.viewport.project(e[0][0]),[s,r]=this.context.viewport.project(e[0][2]);i({pickingInfos:this.context.deck.pickObjects({x:Math.min(n,s),y:Math.min(o,r),width:Math.abs(s-n),height:Math.abs(r-o),layerIds:t})})}_selectPolygonObjects(e){const{layerIds:t,onSelect:i}=this.props,o=e[0].map(e=>this.context.viewport.project(e)),s=o.map(e=>e[0]),l=o.map(e=>e[1]),d=Math.min(...s),c=Math.min(...l),p=Math.max(...s),h=Math.max(...l),g=(0,n.n1)(e),u=(0,r.A)(g,50);let m;try{m=(0,a.A)(u,g)}catch(y){return void console.log("turfDifference() error",y)}this.setState({pendingPolygonSelection:{bigPolygon:m}});const f=this.props.id+"-"+jt;setTimeout(()=>{const e=this.context.deck.pickObjects({x:d,y:c,width:p-d,height:h-c,layerIds:[f,...t]});i({pickingInfos:e.filter(e=>e.layer.id!==this.props.id)})},250)}renderLayers(){const{pendingPolygonSelection:e}=this.state,t=St[this.props.selectionType]||K,i=wt[this.props.selectionType],n={};Mt.forEach(e=>{void 0!==this.props[e]&&(n[e]=this.props[e])});const o=[new ut(this.getSubLayerProps(Object.assign({id:"selection-geojson",pickable:!0,mode:t,modeConfig:i,selectedFeatureIndexes:[],data:At,onEdit:e=>{let{updatedData:t,editType:i}=e;if("addFeature"===i){const{coordinates:e}=t.features[0].geometry;this.props.selectionType===bt?this._selectRectangleObjects(e):this.props.selectionType===Pt&&this._selectPolygonObjects(e)}}},n)))];if(e){const{bigPolygon:t}=e;o.push(new vt.A(this.getSubLayerProps({id:jt,pickable:!0,stroked:!1,opacity:1,data:[t],getLineColor:e=>[0,0,0,1],getFillColor:e=>[0,0,0,1],getPolygon:e=>e.geometry.coordinates})))}return o}shouldUpdateState(e){let{changeFlags:{stateChanged:t,propsOrDataChanged:i}}=e;return t||i}}Ft.layerName="SelectionLayer",Ft.defaultProps=kt;var Tt=i(9105);class Dt extends m.A{renderLayers(){return[new f.A(Object.assign({},this.props,{id:this.props.id+"-ScatterplotLayer",data:this.props.data})),new Tt.A(Object.assign({},this.props,{id:this.props.id+"-LineLayer",data:this.props.data,pickable:!1,getSourcePosition:e=>{let{position:t}=e;return[t[0],t[1],0]},getTargetPosition:e=>{let{position:t}=e;return[t[0],t[1],t[2]||0]},getColor:[150,150,150,200],getStrokeWidth:3}))]}}Dt.layerName="ElevatedEditHandleLayer",Dt.defaultProps={};class Et extends J{constructor(){super(...arguments),this._isResizing=!1}getGuides(e){const t=[],i=e.selectedIndexes,{lastPointerMoveEvent:o}=e,s=o&&o.picks,r=o&&o.mapCoords;if(s&&s.length&&r&&1===i.length&&!this._isResizing){const i=s.find(e=>!e.isGuide);if(i&&i.object.properties.shape&&i.object.properties.shape.includes("Circle")&&e.selectedIndexes.includes(i.index)){let o=null,s=[];const a=(0,n.zx)(r);if(A(i.object.geometry.coordinates,[],(t,i)=>{const r=(0,n.wi)(t),l=this.getNearestPoint(r,a,e.modeConfig&&e.modeConfig.viewport);(!o||l.properties.dist<o.properties.dist)&&(o=l,s=i)}),o){const{geometry:{coordinates:e},properties:{index:n}}=o;t.push({type:"Feature",properties:{guideType:"editHandle",editHandleType:"intermediate",featureIndex:i.index,positionIndexes:[...s,n+1]},geometry:{type:"Point",coordinates:e}})}}}return{type:"FeatureCollection",features:t}}getNearestPoint(e,t,i){const{coordinates:n}=e.geometry;if(n.some(e=>e.length>2)){if(i)return F(e,t,i);console.log("Editing 3D point but modeConfig.viewport not provided. Falling back to 2D logic.")}return(0,pe.A)(e,t)}handleDragging(e,t){const i=T(e.pointerDownPicks);if(i){e.cancelPan();const n=i.properties,o=this.getSelectedFeature(t),s=(0,X.A)(o).geometry.coordinates,r=Object.entries(o.geometry.coordinates[0]).length-1,a=Math.max((0,l.A)(s,e.mapCoords),.001),{steps:d=r}={},c={steps:d},p=(0,Fe.A)(s,a,c).geometry,h=new z(t.data).replaceGeometry(n.featureIndex,p).getObject();t.onEdit({updatedData:h,editType:"unionGeometry",editContext:{featureIndexes:[n.featureIndex]}})}}handlePointerMove(e,t){if(!this._isResizing){const t=T(e.picks);this._selectedEditHandle=t&&"intermediate"===t.properties.editHandleType?t:null}const i=this.getCursor(e);t.onUpdateCursor(i)}handleStartDragging(e,t){this._selectedEditHandle&&(e.cancelPan(),this._isResizing=!0)}handleStopDragging(e,t){this._isResizing&&(this._selectedEditHandle=null,this._isResizing=!1)}getCursor(e){return I(e&&e.picks||[]).length?"cell":null}}class It extends J{getSingleSelectedLineString(e){const t=this.getSelectedGeometry(e);return t&&"LineString"===t.type?t:null}handleClick(e,t){const{selectedIndexes:i}=t,n=this.getSingleSelectedLineString(t);if(!n)return void console.warn("ExtendLineStringMode only supported for single LineString selection");let o=[n.coordinates.length];const s=t.modeConfig;s&&s.drawAtFront&&(o=[0]);const r=i[0],a=new z(t.data).addPosition(r,o,e.mapCoords).getObject();t.onEdit({updatedData:a,editType:"addPosition",editContext:{featureIndexes:[r],positionIndexes:o,position:e.mapCoords}})}getGuides(e){const t={type:"FeatureCollection",features:[]},i=this.getSingleSelectedLineString(e);if(!i)return t;const n=e.lastPointerMoveEvent&&e.lastPointerMoveEvent.mapCoords;if(!n)return t;let o=null;const{modeConfig:s}=e;return o=s&&s.drawAtFront?i.coordinates[0]:i.coordinates[i.coordinates.length-1],t.features.push({type:"Feature",properties:{guideType:"tentative"},geometry:{type:"LineString",coordinates:[o,n]}}),t}handlePointerMove(e,t){t.onUpdateCursor("cell")}}var _t=i(3922);class Lt extends J{constructor(){super(...arguments),this._isMeasuringSessionFinished=!1,this._currentTooltips=[],this._currentDistance=0,this._calculateDistanceForTooltip=e=>{let{positionA:t,positionB:i,modeConfig:n}=e;const{turfOptions:o,measurementCallback:s}=n||{},r=(0,l.A)(t,i,o);return s&&s(r),r}}_formatTooltip(e,t){const{formatTooltip:i,turfOptions:n}=t||{},o=n&&n.units||"kilometers";let s;return s=i?i(e):parseFloat(e).toFixed(2)+" "+o,s}handleClick(e,t){const{modeConfig:i,data:n,onEdit:o}=t,{centerTooltipsOnLine:s=!1}=i||{};this._isMeasuringSessionFinished&&(this._isMeasuringSessionFinished=!1,this.resetClickSequence(),this._currentTooltips=[],this._currentDistance=0);const{picks:r}=e,a=T(r);let l=!1;a||(this.addClickSequence(e),l=!0);const d=this.getClickSequence();if(d.length>1&&a&&Array.isArray(a.properties.positionIndexes)&&a.properties.positionIndexes[0]===d.length-1)this._isMeasuringSessionFinished=!0;else if(l){if(d.length>1){this._currentDistance+=this._calculateDistanceForTooltip({positionA:d[d.length-2],positionB:d[d.length-1],modeConfig:i});const t=s?(0,_t.A)(d[d.length-2],d[d.length-1]).geometry.coordinates:e.mapCoords;this._currentTooltips.push({position:t,text:this._formatTooltip(this._currentDistance,i)})}o({updatedData:n,editType:"addTentativePosition",editContext:{position:e.mapCoords}})}}handleKeyUp(e,t){if(this._isMeasuringSessionFinished)return;e.stopPropagation();const{key:i}=e,n=this.getClickSequence().length;switch(i){case"Escape":this._isMeasuringSessionFinished=!0,1===n&&(this.resetClickSequence(),this._currentTooltips=[]),t.onUpdateCursor("cell");break;case"Enter":this.handleClick(t.lastPointerMoveEvent,t),this._isMeasuringSessionFinished=!0}}getGuides(e){const{lastPointerMoveEvent:t}=e,i=this.getClickSequence(),n=t&&!this._isMeasuringSessionFinished?[t.mapCoords]:[],o={type:"FeatureCollection",features:[]};i.length>0&&o.features.push({type:"Feature",properties:{guideType:"tentative"},geometry:{type:"LineString",coordinates:[...i,...n]}});const s=i.map((e,t)=>({type:"Feature",properties:{guideType:"editHandle",editHandleType:"existing",featureIndex:-1,positionIndexes:[t]},geometry:{type:"Point",coordinates:e}}));return o.features.push(...s),o}handlePointerMove(e,t){t.onUpdateCursor("cell")}getTooltips(e){const{lastPointerMoveEvent:t,modeConfig:i}=e,{centerTooltipsOnLine:n=!1}=i||{},o=this.getClickSequence();if(o.length>0&&t&&!this._isMeasuringSessionFinished){const s=this._calculateDistanceForTooltip({positionA:o[o.length-1],positionB:t.mapCoords,modeConfig:e.modeConfig}),r=n?(0,_t.A)(o[o.length-1],t.mapCoords).geometry.coordinates:t.mapCoords;return[...this._currentTooltips,{position:r,text:this._formatTooltip(this._currentDistance+s,i)}]}return this._currentTooltips}}const Ot=[];class Ht extends ve{handleClick(e,t){const i=Object.assign({},t,{onEdit:()=>{}});super.handleClick(e,i)}handleKeyUp(e,t){const i=Object.assign({},t,{onEdit:()=>{}});super.handleKeyUp(e,i)}getTooltips(e){const t=this.getTentativeGuide(e);if(t&&"Polygon"===t.geometry.type){const{modeConfig:i}=e,{formatTooltip:n,measurementCallback:o}=i||{},s="sq. m",r=(0,ie.A)(t),a=(0,Te.A)(t);let l;return l=n?n(a):parseFloat(a).toFixed(2)+" "+s,o&&o(a),[{position:r.geometry.coordinates,text:l}]}return Ot}}const zt=[];class Rt extends J{constructor(){super(...arguments),this._getTooltips=xe(e=>{let{modeConfig:t,vertex:i,point1:n,point2:o}=e,s=zt;if(i&&n&&o){const{formatTooltip:e,measurementCallback:r}=t||{},a="deg",l=(0,h.A)(i,n),d=(0,h.A)(i,o);let c,p=Math.abs(l-d);p>180&&(p=360-p),c=e?e(p):parseFloat(p).toFixed(2)+" "+a,r&&r(p);s=[{position:(0,X.A)({type:"FeatureCollection",features:[n,o].map(e=>({type:"Feature",geometry:{type:"Point",coordinates:e},properties:{}}))}).geometry.coordinates,text:c}]}return s})}handleClick(e,t){this.getClickSequence().length>=3&&this.resetClickSequence(),this.addClickSequence(e)}handlePointerMove(e,t){t.onUpdateCursor("cell")}getPoints(e){const t=this.getClickSequence(),i=[...t];return t.length<3&&e.lastPointerMoveEvent&&i.push(e.lastPointerMoveEvent.mapCoords),i}getGuides(e){const t={type:"FeatureCollection",features:[]},{features:i}=t,n=this.getPoints(e);return n.length>2?i.push({type:"Feature",properties:{guideType:"tentative"},geometry:{type:"LineString",coordinates:[n[1],n[0],n[2]]}}):n.length>1&&i.push({type:"Feature",properties:{guideType:"tentative"},geometry:{type:"LineString",coordinates:[n[1],n[0]]}}),t}getTooltips(e){const t=this.getPoints(e);return this._getTooltips({modeConfig:e.modeConfig,vertex:t[0],point1:t[1],point2:t[2]})}}},4820:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>B,contentTitle:()=>U,default:()=>V,frontMatter:()=>G,metadata:()=>n,toc:()=>W});const n=JSON.parse('{"id":"editable-layers/advanced","title":"Advanced","description":"","source":"@site/src/examples/editable-layers/advanced.mdx","sourceDirName":"editable-layers","slug":"/editable-layers/advanced","permalink":"/deck.gl-community/examples/editable-layers/advanced","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"examplesSidebar","previous":{"title":"Editor","permalink":"/deck.gl-community/examples/editable-layers/editor"},"next":{"title":"deck.gl with Leaflet","permalink":"/deck.gl-community/examples/leaflet/get-started"}}');var o=i(4848),s=i(8453),r=i(454),a=i(6540),l=i(9813),d=i(340),c=i(840),p=i(5800),h=i(7564),g=i(5605),u=i(6338),m=i(4653),f=i(6467);const y=JSON.parse('{"type":"FeatureCollection","features":[{"type":"Feature","properties":{"marker-color":"#ff0000","marker-size":"medium","marker-symbol":""},"geometry":{"type":"Point","coordinates":[-122.44477272033691,37.79906910652822]}},{"type":"Feature","properties":{"marker-color":"#0000ff","marker-size":"large","marker-symbol":""},"geometry":{"type":"Point","coordinates":[-122.42451667785645,37.8019175085504]}},{"type":"Feature","properties":{"marker-size":"small"},"geometry":{"type":"MultiPoint","coordinates":[[-122.46923446655273,37.803273851858656],[-122.46957778930665,37.79934038764369],[-122.46434211730958,37.80313821864869],[-122.46451377868652,37.8001542250124]]}},{"type":"Feature","properties":{"stroke":"#ff0000","stroke-width":10,"stroke-opacity":1},"geometry":{"type":"LineString","coordinates":[[-122.40880966186523,37.783536601521924],[-122.43893623352051,37.779669924659004],[-122.43515968322752,37.7624370109886],[-122.42348670959471,37.77180027337861],[-122.4250316619873,37.778584505321376],[-122.42314338684082,37.778652344496926],[-122.42357254028322,37.77987343901049],[-122.41198539733887,37.78109451335266]]}},{"type":"Feature","properties":{"stroke":"#408000","stroke-width":2,"stroke-opacity":1},"geometry":{"type":"MultiLineString","coordinates":[[[-122.39670753479004,37.7947284731866],[-122.44726181030273,37.788352705583755]],[[-122.44709014892577,37.78733524495977],[-122.39670753479004,37.79371110035437]]]}},{"type":"Feature","properties":{"stroke":"#800000","stroke-width":3,"stroke-opacity":0.5,"fill":"#ffff66","fill-opacity":1},"geometry":{"type":"Polygon","coordinates":[[[-122.51129150390625,37.771461045439764],[-122.46588706970215,37.77342854582093],[-122.45464324951172,37.77471756940714],[-122.45284080505371,37.76644028998291],[-122.45747566223145,37.765761783370465],[-122.45902061462401,37.76644028998291],[-122.5100040435791,37.763997637045456],[-122.51026153564452,37.767254489700846],[-122.51129150390625,37.771461045439764]],[[-122.50802993774414,37.770239811973674],[-122.45644569396974,37.77302148107203],[-122.45515823364258,37.76759373693769],[-122.45884895324706,37.76847577247014],[-122.50811576843262,37.765693932366865],[-122.50802993774414,37.770239811973674]]]}},{"type":"Feature","properties":{"stroke":"#004080","stroke-width":2,"stroke-opacity":1,"fill":"#66ff66","fill-opacity":0.5},"geometry":{"type":"MultiPolygon","coordinates":[[[[-122.4717664718628,37.73094604426975],[-122.47253894805908,37.71706268973759],[-122.47116565704346,37.71275119199666],[-122.47017860412596,37.71275119199666],[-122.46803283691405,37.712411693330296],[-122.46524333953857,37.712445643266925],[-122.46339797973633,37.71146108878938],[-122.46026515960692,37.71037466866717],[-122.45494365692137,37.7111215842122],[-122.44975090026854,37.71533133102705],[-122.4481201171875,37.72123815310796],[-122.45236873626708,37.723037263958275],[-122.4605655670166,37.72480238685191],[-122.46584415435791,37.72670324138648],[-122.46803283691405,37.72863798965106],[-122.468204498291,37.72938472107615],[-122.4717664718628,37.73094604426975]]],[[[-122.435245513916,37.73155698786267],[-122.42983818054199,37.73237157147889],[-122.42563247680664,37.73155698786267],[-122.42048263549805,37.73182851673044],[-122.41559028625487,37.732100044602525],[-122.40846633911133,37.73488314788311],[-122.40752220153807,37.73732676207096],[-122.40769386291502,37.74173863896063],[-122.4052906036377,37.74920429313147],[-122.4085521697998,37.748322027789115],[-122.42511749267578,37.74777909004261],[-122.42374420166016,37.73977029560411],[-122.42683410644533,37.73603708685575],[-122.435245513916,37.73155698786267]]],[[[-122.49532699584961,37.75347973770911],[-122.493953704834,37.73379707124429],[-122.4752426147461,37.73488314788311],[-122.47644424438477,37.75429408009598],[-122.49532699584961,37.75347973770911]]]]}}]}');var x=i(3724);const C={toolboxItem:{flexBasis:"50%"}},v=x.Ay.div.withConfig({displayName:"toolbox__Toolbox",componentId:"sc-1c3nzj2-0"})(["position:absolute;top:0px;left:0px;color:#f0f0f0;padding:0;width:230px;height:100%;font-family:Arial,Helvetica,sans-serif;font-size:16px;overflow:auto;z-index:30;"]),b=e=>(0,o.jsx)("div",{children:e.children}),P=e=>(0,o.jsx)("div",{style:C.toolboxItem,children:e.children}),S=x.Ay.div.withConfig({displayName:"toolbox__ToolboxTitle",componentId:"sc-1c3nzj2-1"})(["background:rgba(39,45,59,0.8);font-size:16px;height:44px;display:flex;align-items:center;padding:0px 8px;"]),w=e=>e.selected?"rgba(30, 84, 183, 0.8)":"rgba(23, 28, 41, 0.8)",k=x.Ay.button.withConfig({displayName:"toolbox__ToolboxButton",componentId:"sc-1c3nzj2-2"})(["display:block;width:100%;border:none;color:#f0f0f0;background:",";text-align:left;font-size:16px;outline:none;height:44px;cursor:pointer;&:hover{background:#276ef1;}"],w),A=x.Ay.div.withConfig({displayName:"toolbox__ToolboxCheckboxContainer",componentId:"sc-1c3nzj2-3"})(["display:flex;align-items:center;width:100%;border:none;color:#f0f0f0;background:",";text-align:left;text-transform:capitalize;font-size:16px;outline:none;height:44px;cursor:pointer;&:hover{background:#276ef1;}"],w),j=e=>(0,o.jsx)("label",{children:(0,o.jsxs)(A,{children:[(0,o.jsx)("input",Object.assign({},Object.assign({},e,{children:null}))),e.children]})}),M=new m.H2([new m.DS,new m.uq]),F={mapContainer:{alignItems:"stretch",display:"flex",height:"100vh"},checkbox:{margin:10}},T={bearing:0,height:0,latitude:37.76,longitude:-122.44,pitch:0,width:0,zoom:11},D=[{category:"View",modes:[{label:"View",mode:m.nE},{label:"Measure Distance",mode:m.L6},{label:"Measure Area",mode:m.vX},{label:"Measure Angle",mode:m.Dx}]},{category:"Draw",modes:[{label:"Draw Point",mode:m.i_},{label:"Draw LineString",mode:m.DS},{label:"Draw Polygon",mode:m.cR},{label:"Draw 90\xb0 Polygon",mode:m.Jt},{label:"Draw Polygon By Dragging",mode:m.G2},{label:"Draw Rectangle",mode:m.hh},{label:"Draw Rectangle From Center",mode:m.E6},{label:"Draw Rectangle Using 3 Points",mode:m.UD},{label:"Draw Square",mode:m.Vv},{label:"Draw Square From Center",mode:m.OH},{label:"Draw Circle From Center",mode:m.Zy},{label:"Draw Circle By Diameter",mode:m.O5},{label:"Draw Ellipse By Bounding Box",mode:m.UP},{label:"Draw Ellipse Using 3 Points",mode:m.hP}]},{category:"Alter",modes:[{label:"Modify",mode:m.uq},{label:"Resize Circle",mode:m.C$},{label:"Elevation",mode:m.l$},{label:"Translate",mode:new m.UX(new m.O1)},{label:"Rotate",mode:m.Dr},{label:"Scale",mode:m.GN},{label:"Duplicate",mode:m.ls},{label:"Extend LineString",mode:m.X5},{label:"Extrude",mode:m.fb},{label:"Split",mode:m.m0},{label:"Transform",mode:new m.UX(new m._C)}]},{category:"Composite",modes:[{label:"Draw LineString + Modify",mode:M}]}],E=[m.cR,m.Jt,m.G2,m.hh,m.E6,m.UD,m.Vv,m.OH,m.Zy,m.O5,m.UP,m.hP],I=[m.hh,m.Vv,m.E6,m.OH,m.Zy,m.O5,m.UP],_={type:"FeatureCollection",features:[]};const L=["00AEE4","DAF0E3","9BCC32","07A35A","F7DF90","EA376C","6A126A","FCB09B","B0592D","C1B5E3","9C805B","CCDFE5"].map(function(e){const t=parseInt(e,16);return[16,8,0].map(e=>(t>>e&255)/255)});function O(e){return e.__source?e.__source.object.properties.editHandleType:e.sourceFeature?e.sourceFeature.feature.properties.editHandleType:e.properties?e.properties.editHandleType:e.type}function H(e){switch(O(e)){case"existing":return[255,128,0,255];case"snap-source":return[192,128,240,255];default:return[255,192,128,255]}}class z extends a.Component{constructor(e){super(e),this._onChangeViewport=e=>{this.setState({viewport:Object.assign({},this.state.viewport,e)})},this._onLayerClick=e=>{console.log("onLayerClick",e),this.state.mode!==m.nE||this.state.selectionTool||(e?(console.log("select editing feature "+e.index),this.setState({selectedFeatureIndexes:[e.index]})):(console.log("deselect editing feature"),this.setState({selectedFeatureIndexes:[]})))},this._resize=()=>{this.forceUpdate()},this._loadSample=e=>{if("mixed"===e)this.setState({testFeatures:y,selectedFeatureIndexes:[]});else if("complex"===e)this.setState({testFeatures:{type:"FeatureCollection",features:[(0,u.A)([-122.45,37.81],4,{steps:5e3}),(0,u.A)([-122.33,37.81],4,{steps:5e3}),(0,u.A)([-122.45,37.73],4,{steps:5e3}),(0,u.A)([-122.33,37.73],4,{steps:5e3})]},selectedFeatureIndexes:[]});else if("blank"===e)this.setState({testFeatures:_,selectedFeatureIndexes:[]});else if("file"===e){const e=document.createElement("input");e.type="file",e.onchange=e=>{const t=e.target;if(t.files&&t.files[0]){const e=new FileReader;e.onload=e=>{let{target:t}=e;this._parseStringJson(t.result)},e.readAsText(t.files[0])}},e.click()}},this._copy=()=>{navigator&&navigator.clipboard?navigator.clipboard.writeText(JSON.stringify(this.state.testFeatures)):this._error("No navigator.clipboard")},this._paste=()=>{navigator&&navigator.clipboard?navigator.clipboard.readText().then(e=>{this._parseStringJson(e)},e=>{this._error(e)}):this._error("No navigator.clipboard")},this._download=()=>{const e=new Blob([JSON.stringify(this.state.testFeatures)],{type:"octet/stream"}),t=document.createElement("a");t.href=URL.createObjectURL(e),t.download="nebula.geojson",t.click()},this._parseStringJson=e=>{let t=null;try{t=JSON.parse(e),Array.isArray(t)&&(t={type:"FeatureCollection",features:t}),console.log("Loaded JSON:",t),this.setState({testFeatures:t})}catch(i){this._error(i)}},this._error=e=>{alert(e)},this.onEdit=e=>{let{updatedData:t,editType:i,editContext:n}=e,o=this.state.selectedFeatureIndexes;if(!["movePosition","extruding","rotating","translating","scaling","updateTentativeFeature"].includes(i)){const e=function(e){const t=e.features.map(e=>e.geometry.type+"("+function(e){const t=(e,t)=>t.reduce((t,i)=>[...t,...e(i)],[]),{type:i,coordinates:n}=e;switch(i){case"Point":return 1;case"LineString":case"MultiPoint":return n.length;case"Polygon":case"MultiLineString":return t(e=>e,n).length;case"MultiPolygon":return t(e=>t(e=>e,e),n).length;default:throw Error("Unknown geometry type: "+i)}}(e.geometry)+")");return JSON.stringify(t)}(t);console.log("onEdit",i,n,e)}if("removePosition"!==i||this.state.pointsRemovable){if("addFeature"===i&&this.state.mode!==m.ls){const{featureIndexes:e}=n;o=[...this.state.selectedFeatureIndexes,...e]}this.setState({testFeatures:t,selectedFeatureIndexes:o})}},this.getFillColor=(e,t)=>{const i=this.state.testFeatures.features.indexOf(e);return t?this._getDeckColorForFeature(i,1,.5):this._getDeckColorForFeature(i,.5,.5)},this.getLineColor=(e,t)=>{const i=this.state.testFeatures.features.indexOf(e);return t?this._getDeckColorForFeature(i,1,1):this._getDeckColorForFeature(i,.5,1)},this.state={viewport:T,testFeatures:y,mode:m.cR,modeConfig:null,pointsRemovable:!0,selectedFeatureIndexes:[],editHandleType:"point",selectionTool:void 0,showGeoJson:!1,pathMarkerLayer:!1,featureMenu:void 0}}componentDidMount(){window.addEventListener("resize",this._resize)}componentWillUnmount(){window.removeEventListener("resize",this._resize)}_getHtmlColorForFeature(e,t){const i=L.length;return"rgba("+L[e%i].map(e=>255*e).join(",")+", "+(t?1:.7)+")"}_getDeckColorForFeature(e,t,i){const n=L.length;return[...L[e%n].map(e=>e*t*255),255*i]}_renderSelectFeatureCheckbox(e,t){const{selectedFeatureIndexes:i}=this.state;return(0,o.jsx)("div",{children:(0,o.jsxs)(j,{style:F.checkbox,type:"checkbox",checked:i.includes(e),onChange:()=>{i.includes(e)?this.setState({selectedFeatureIndexes:i.filter(t=>t!==e)}):this.setState({selectedFeatureIndexes:[...i,e]})},children:[(0,o.jsxs)("span",{style:{color:this._getHtmlColorForFeature(e,i.includes(e))},children:[e,": ",t]}),(0,o.jsx)("a",{style:{position:"absolute",right:12},onClick:t=>{t.preventDefault(),t.stopPropagation(),this.setState({selectedFeatureIndexes:[e],featureMenu:{index:e,x:t.clientX,y:t.clientY}})},children:">>"})]})},e)}_renderSelectFeatureCheckboxes(){const{testFeatures:{features:e}}=this.state,t=[];for(let i=0;i<e.length;++i)t.push(this._renderSelectFeatureCheckbox(i,e[i].geometry.type));return t}_renderBooleanOperationControls(){return(0,o.jsxs)(b,{children:[(0,o.jsxs)(S,{children:["Boolean operation",(0,o.jsx)("br",{}),"(requires single selection)"]}),(0,o.jsx)(P,{children:["union","difference","intersection"].map(e=>(0,o.jsx)(k,{selected:this.state.modeConfig&&this.state.modeConfig.booleanOperation===e,onClick:()=>{this.state.modeConfig&&this.state.modeConfig.booleanOperation===e?this.setState({modeConfig:Object.assign({},this.state.modeConfig||{},{booleanOperation:null})}):this.setState({modeConfig:Object.assign({},this.state.modeConfig||{},{booleanOperation:e})})},children:e},e))})]},"booleanOperations")}_renderTwoClickPolygonControls(){return(0,o.jsxs)(b,{children:[(0,o.jsx)(S,{children:"Drag to draw"}),(0,o.jsx)(P,{children:(0,o.jsx)("input",{type:"checkbox",checked:Boolean(this.state.modeConfig&&this.state.modeConfig.dragToDraw),onChange:e=>this.setState({modeConfig:Object.assign({},this.state.modeConfig||{},{dragToDraw:Boolean(e.target.checked)})})})})]},"twoClick")}_renderModifyModeControls(){return(0,o.jsxs)(b,{children:[(0,o.jsx)(S,{children:"Allow removing points"}),(0,o.jsx)(P,{children:(0,o.jsx)("input",{type:"checkbox",checked:this.state.pointsRemovable,onChange:()=>this.setState({pointsRemovable:!this.state.pointsRemovable})})})]},"modify")}_renderSplitModeControls(){return(0,o.jsxs)(b,{children:[(0,o.jsx)(S,{children:"Constrain to 90\xb0"}),(0,o.jsx)(P,{children:(0,o.jsx)("input",{type:"checkbox",checked:Boolean(this.state.modeConfig&&this.state.modeConfig.lock90Degree),onChange:e=>this.setState({modeConfig:{lock90Degree:Boolean(e.target.checked)}})})})]},"split")}_renderSnappingControls(){return(0,o.jsx)("div",{children:(0,o.jsxs)(b,{children:[(0,o.jsx)(S,{children:"Enable snapping"}),(0,o.jsx)(P,{children:(0,o.jsx)("input",{type:"checkbox",checked:Boolean(this.state.modeConfig&&this.state.modeConfig.enableSnapping),onChange:e=>{const t=Object.assign({},this.state.modeConfig,{enableSnapping:Boolean(e.target.checked)});this.setState({modeConfig:t})}})})]})},"snap")}_renderMeasureDistanceControls(){return(0,o.jsxs)(b,{children:[(0,o.jsx)(S,{children:"Units"}),(0,o.jsx)(P,{children:(0,o.jsxs)("select",{value:this.state.modeConfig&&this.state.modeConfig.turfOptions&&this.state.modeConfig.turfOptions.units||"kilometers",onChange:e=>{const t=Object.assign({},this.state.modeConfig,{turfOptions:{units:e.target.value}});this.setState({modeConfig:t})},children:[(0,o.jsx)("option",{value:"kilometers",children:"kilometers"}),(0,o.jsx)("option",{value:"miles",children:"miles"}),(0,o.jsx)("option",{value:"degrees",children:"degrees"}),(0,o.jsx)("option",{value:"radians",children:"radians"})]})}),(0,o.jsx)(S,{children:"Center Tooltips on Line"}),(0,o.jsx)(P,{children:(0,o.jsx)("input",{type:"checkbox",checked:Boolean(this.state.modeConfig&&this.state.modeConfig.centerTooltipsOnLine),onChange:e=>{const t=Object.assign({},this.state.modeConfig,{centerTooltipsOnLine:Boolean(e.target.checked)});this.setState({modeConfig:t})}})})]},"measure-distance")}_renderDrawPolygonModeControls(){return(0,o.jsxs)(b,{children:[(0,o.jsx)(S,{children:"Prevent overlapping lines"}),(0,o.jsx)(P,{children:(0,o.jsx)("input",{type:"checkbox",checked:Boolean(this.state.modeConfig&&this.state.modeConfig.preventOverlappingLines),onChange:e=>this.setState({modeConfig:Object.assign({},this.state.modeConfig||{},{preventOverlappingLines:Boolean(e.target.checked)})})})})]},"draw-polygon")}_renderModeConfigControls(){const e=[];return E.indexOf(this.state.mode)>-1&&e.push(this._renderBooleanOperationControls()),I.indexOf(this.state.mode)>-1&&e.push(this._renderTwoClickPolygonControls()),this.state.mode===m.uq&&e.push(this._renderModifyModeControls()),this.state.mode===m.m0&&e.push(this._renderSplitModeControls()),this.state.mode instanceof m.UX&&e.push(this._renderSnappingControls()),this.state.mode===m.L6&&e.push(this._renderMeasureDistanceControls()),this.state.mode===m.cR&&e.push(this._renderDrawPolygonModeControls()),e}_renderToolBox(){return(0,o.jsxs)(v,{children:[D.map(e=>(0,o.jsxs)(b,{children:[(0,o.jsxs)(S,{children:[e.category," Modes"]}),e.modes.map(e=>{let{mode:t,label:i}=e;return(0,o.jsx)(k,{selected:this.state.mode===t,onClick:()=>{this.setState({mode:t,modeConfig:{},selectionTool:void 0})},children:i},i)})]},e.category)),this._renderModeConfigControls(),this.state.showGeoJson&&(0,o.jsxs)(a.Fragment,{children:[(0,o.jsx)(S,{children:"GeoJSON"}),(0,o.jsx)(k,{onClick:()=>this.setState({showGeoJson:!this.state.showGeoJson}),children:"hide \u25b2"}),(0,o.jsx)(P,{children:(0,o.jsx)("textarea",{id:"geo-json-text",rows:5,style:{width:"100%"},value:JSON.stringify(this.state.testFeatures),onChange:e=>this.setState({testFeatures:JSON.parse(e.target.value)})})})]}),!this.state.showGeoJson&&(0,o.jsxs)(a.Fragment,{children:[(0,o.jsx)(S,{children:"GeoJSON"}),(0,o.jsx)(k,{onClick:()=>this.setState({showGeoJson:!this.state.showGeoJson}),children:"show \u25bc"})]}),(0,o.jsx)(k,{onClick:()=>this._copy(),children:"Copy"}),(0,o.jsx)(k,{onClick:()=>this._paste(),children:"Paste"}),(0,o.jsx)(k,{onClick:()=>this._download(),children:"Download"}),(0,o.jsxs)(b,{children:[(0,o.jsx)(S,{children:"Load data"}),(0,o.jsxs)(P,{children:[(0,o.jsx)(k,{onClick:()=>this._loadSample("mixed"),children:"Mixed Sample"}),(0,o.jsx)(k,{onClick:()=>this._loadSample("complex"),children:"Complex Sample"}),(0,o.jsx)(k,{onClick:()=>this._loadSample("blank"),children:"Blank"}),(0,o.jsx)(k,{onClick:()=>this._loadSample("file"),children:"Open file..."})]})]}),(0,o.jsxs)(b,{children:[(0,o.jsx)(S,{children:"Options"}),(0,o.jsx)(P,{children:(0,o.jsx)(j,{type:"checkbox",checked:"icon"===this.state.editHandleType,onChange:()=>this.setState({editHandleType:"icon"===this.state.editHandleType?"point":"icon"}),children:"Use Icons"})}),(0,o.jsx)(P,{children:(0,o.jsx)(j,{type:"checkbox",checked:"elevated"===this.state.editHandleType,onChange:()=>this.setState({editHandleType:"elevated"===this.state.editHandleType?"point":"elevated"}),children:"Use ElevatedEditHandleLayer"})}),(0,o.jsx)(P,{children:(0,o.jsx)(j,{type:"checkbox",checked:this.state.pathMarkerLayer,onChange:()=>this.setState({pathMarkerLayer:!this.state.pathMarkerLayer}),children:"Use PathMarkerLayer"})})]}),(0,o.jsxs)(b,{children:[(0,o.jsx)(S,{children:"Select Features"}),(0,o.jsxs)(P,{children:[(0,o.jsx)(k,{onClick:()=>this.setState({selectedFeatureIndexes:[],selectionTool:m.Sn.NONE}),children:"Clear Selection"}),(0,o.jsx)(k,{onClick:()=>this.setState({mode:m.nE,selectionTool:m.Sn.RECTANGLE}),children:"Rect Select"}),(0,o.jsx)(k,{onClick:()=>this.setState({mode:m.nE,selectionTool:m.Sn.POLYGON}),children:"Lasso Select"})]})]}),(0,o.jsx)(S,{children:"Features"}),(0,o.jsx)(b,{children:this._renderSelectFeatureCheckboxes()})]})}renderStaticMap(e){return(0,o.jsx)(g.Ay,Object.assign({},e,{mapStyle:"https://basemaps.cartocdn.com/gl/positron-gl-style/style.json"}))}_featureMenuClick(e){const{index:t}=this.state.featureMenu||{};let i=this.state.testFeatures;if("delete"===e){const e=[...i.features];e.splice(t,1),i=Object.assign({},i,{features:e})}else"split"===e||"info"===e&&console.log(i.features[t]);this.setState({featureMenu:null,testFeatures:i})}_renderFeatureMenu(e){let{x:t,y:i}=e;return(0,o.jsxs)("div",{style:{position:"fixed",top:i-40,left:t+20},children:[(0,o.jsx)(k,{onClick:()=>this._featureMenuClick("delete"),children:"Delete"}),(0,o.jsx)(k,{onClick:()=>this._featureMenuClick("split"),children:"Split"}),(0,o.jsx)(k,{onClick:()=>this._featureMenuClick("info"),children:"Info"}),(0,o.jsx)(k,{onClick:()=>this._featureMenuClick(""),children:"Close"})]})}customizeLayers(e){}render(){const{testFeatures:e,selectedFeatureIndexes:t,mode:i}=this.state;let{modeConfig:n}=this.state;const s=Object.assign({},this.state.viewport,{height:window.innerHeight,width:window.innerWidth});i===m.l$?n=Object.assign({},n,{viewport:s,calculateElevationChange:e=>m.l$.calculateElevationChangeWithViewport(s,e)}):i===m.uq?n=Object.assign({},n,{viewport:s,lockRectangles:!0}):i instanceof m.UX&&n?(i._handler instanceof m.O1&&(n=Object.assign({},n,{viewport:s,screenSpace:!0})),n&&n.enableSnapping&&(n=Object.assign({},n,{additionalSnapTargets:[{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[-122.52235,37.734008],[-122.52217,37.712706],[-122.49436,37.711979],[-122.49725,37.734306],[-122.52235,37.734008]]]}}]}))):i===m.G2&&(n=Object.assign({},n,{throttleMs:100}));let r={tooltips:{getColor:[255,255,255,255]}};"elevated"===this.state.editHandleType&&(r=Object.assign(r,{guides:{_subLayerProps:{points:{type:m.IM,getFillColor:[0,255,0]}}}})),this.state.pathMarkerLayer&&(r=Object.assign(r,{geojson:{_subLayerProps:{linestrings:{type:f.P,getMarkerColor:e=>[255,255,255,255],sizeScale:1500}}}}));const a=new m.Tp({id:"geojson",data:e,selectedFeatureIndexes:t,mode:i,modeConfig:n,autoHighlight:!1,onEdit:this.onEdit,editHandleType:this.state.editHandleType,editHandleIconAtlas:"data:image/png;base64,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",editHandleIconMapping:{intermediate:{x:0,y:0,width:58,height:58,mask:!1},existing:{x:58,y:0,width:58,height:58,mask:!1},"snap-source":{x:58,y:0,width:58,height:58,mask:!1},"snap-target":{x:0,y:0,width:58,height:58,mask:!1}},getEditHandleIcon:e=>O(e),getEditHandleIconSize:40,getEditHandleIconColor:H,pointRadiusMinPixels:5,getFillColor:this.getFillColor,getLineColor:this.getLineColor,getEditHandlePointColor:H,editHandlePointRadiusScale:2,_subLayerProps:r,parameters:{depthTest:!0,depthMask:!1,blend:!0,blendEquation:32774,blendFunc:[770,771]}}),l=[a];return this.state.selectionTool&&l.push(new m.cW({id:"selection",selectionType:this.state.selectionTool,onSelect:e=>{let{pickingInfos:t}=e;this.setState({selectedFeatureIndexes:t.map(e=>e.index)})},layerIds:["geojson"],getTentativeFillColor:()=>[255,0,255,100],getTentativeLineColor:()=>[0,0,255,255],lineWidthMinPixels:3})),this.customizeLayers(l),(0,o.jsxs)("div",{style:F.mapContainer,children:[(0,o.jsx)(c.A,{viewState:s,getCursor:a.getCursor.bind(a),layers:l,height:"100%",width:"100%",views:[new p.A({id:"basemap",controller:{type:h.A,doubleClickZoom:!1}})],onClick:this._onLayerClick,onViewStateChange:e=>{let{viewState:t}=e;return this.setState({viewport:t})},children:this.renderStaticMap(s)}),this._renderToolBox(),this.state.featureMenu&&this._renderFeatureMenu(this.state.featureMenu)]})}}var R=i(4451);class N extends a.Component{static renderInfo(e){return(0,o.jsx)(o.Fragment,{})}render(){const e=this.props,t=Object.assign({},((0,r.A)(e),e));return(0,o.jsx)(l.A,{children:()=>(0,o.jsx)(z,Object.assign({},t))})}}N.title="Advanced",N.code=d.lP+"/examples/editable-layers/advanced";const q=(0,R.xv)(N),G={},U="Advanced",B={},W=[];function J(e){const t={h1:"h1",header:"header",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.header,{children:(0,o.jsx)(t.h1,{id:"advanced",children:"Advanced"})}),"\n","\n",(0,o.jsx)(q,{})]})}function V(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(J,{...e})}):J(e)}},6467:(e,t,i)=>{i.d(t,{P:()=>j});var n=i(9452),o=i(9350),s=i(8095),r=i(8643),a=i(4968);const l={outlineEnabled:!1,outlineRenderShadowmap:!1,outlineShadowmap:null};const d={name:"outline",vs:"#version 300 es\nin float instanceZLevel;\nout float outline_vzLevel;\nout vec4 outline_vPosition;\n\n// Set the z level for the outline shadowmap rendering\nvoid outline_setZLevel(float zLevel) {\n  outline_vzLevel = zLevel;\n}\n\n// Store an adjusted position for texture2DProj\nvoid outline_setUV(vec4 position) {\n  // mat4(\n  //   0.5, 0.0, 0.0, 0.0,\n  //   0.0, 0.5, 0.0, 0.0,\n  //   0.0, 0.0, 0.5, 0.0,\n  //   0.5, 0.5, 0.5, 1.0\n  // ) * position;\n  outline_vPosition = vec4(position.xyz * 0.5 + position.w * 0.5, position.w);\n}\n",fs:"uniform bool outline_uEnabled;\nuniform bool outline_uRenderOutlines;\nuniform sampler2D outline_uShadowmap;\n\nin float outline_vzLevel;\n// in vec2 outline_vUV;\nin vec4 outline_vPosition;\n\nout vec4 fragColor;\n\nconst float OUTLINE_Z_LEVEL_ERROR = 0.01;\n\n// Return a darker color in shadowmap\nvec4 outline_filterShadowColor(vec4 color) {\n  return vec4(outline_vzLevel / 255., outline_vzLevel / 255., outline_vzLevel / 255., 1.);\n}\n\n// Return a darker color if in shadowmap\nvec4 outline_filterDarkenColor(vec4 color) {\n  if (outline_uEnabled) {\n    float maxZLevel;\n    if (outline_vPosition.q > 0.0) {\n      maxZLevel = texture2DProj(outline_uShadowmap, outline_vPosition).r * 255.;\n    } else {\n      discard;\n    }\n    if (maxZLevel < outline_vzLevel + OUTLINE_Z_LEVEL_ERROR) {\n      vec4(color.rgb * 0.5, color.a);\n    } else {\n      discard;\n    }\n  }\n  return color;\n}\n\n// if enabled and rendering outlines - Render depth to shadowmap\n// if enabled and rendering colors - Return a darker color if in shadowmap\n// if disabled, just return color\nvec4 outline_filterColor(vec4 color) {\n  if (outline_uEnabled) {\n    return outline_uRenderOutlines ?\n      outline_filterShadowColor(color) :\n      outline_filterDarkenColor(color);\n  }\n  return color;\n}\n",getUniforms:function(e){let{outlineEnabled:t,outlineRenderShadowmap:i,outlineShadowmap:n}=void 0===e?l:e;const o={};return void 0!==t&&(o.outline_uEnabled=t),void 0!==i&&(o.outline_uRenderOutlines=i),void 0!==n&&(o.outline_uShadowmap=n),o}},c={common:0,meters:1,pixels:2};function p(e){let{source:t,code:i=""}=e;return t.replace(/}[^{}]*$/,i.concat("\n}\n"))}class h extends a.A{constructor(){super(...arguments),this.state=void 0}getShaders(){const e=super.getShaders();return Object.assign({},e,{modules:e.modules.concat([d]),vs:p({source:e.vs,code:"  outline_setUV(gl_Position);\n  outline_setZLevel(instanceZLevel);\n"}),fs:p({source:e.fs,code:"  fragColor = outline_filterColor(fragColor);\n"})})}initializeState(e){super.initializeState(),this.setState({outlineFramebuffer:e.device.createFramebuffer({}),dummyTexture:e.device.createTexture({width:1,height:1})}),this.state.attributeManager.addInstanced({instanceZLevel:{size:1,type:5121,accessor:"getZLevel"}})}draw(e){let{moduleParameters:t={},parameters:i,uniforms:n,context:o}=e;const{jointRounded:s,capRounded:r,billboard:a,miterLimit:l,widthUnits:d,widthScale:p,widthMinPixels:h,widthMaxPixels:g}=this.props;n=Object.assign({},n,{jointType:Number(s),capType:Number(r),billboard:a,widthUnits:c[d],widthScale:p,miterLimit:l,widthMinPixels:h,widthMaxPixels:g});const{outlineFramebuffer:u,dummyTexture:m}=this.state;this.state.model.updateModuleSettings({outlineEnabled:!0,outlineRenderShadowmap:!0,outlineShadowmap:m}),this.state.model.draw({uniforms:Object.assign({},n,{jointType:0,widthScale:1.3*this.props.widthScale}),parameters:{depthTest:!1,blendEquation:32776},framebuffer:u}),this.state.model.updateModuleSettings({outlineEnabled:!0,outlineRenderShadowmap:!1,outlineShadowmap:u}),this.state.model.draw({uniforms:Object.assign({},n,{jointType:Number(s),capType:Number(r),widthScale:this.props.widthScale}),parameters:{depthTest:!1}})}}h.layerName="PathOutlineLayer",h.defaultProps={getZLevel:()=>0};var g=i(5337);class u extends g.V{constructor(e){void 0===e&&(e={}),super(Object.assign({},e,{attributes:m(e),topology:"triangle-list"}))}}function m(e){let{length:t=1,headSize:i=.2,tailWidth:n=.05,tailStart:o=.05}=e;const s=[.5,1,0,.5-i/2,1-i,0,.5+i/2,1-i,0,.5-n/2,o,0,.5+n/2,1-i,0,.5+n/2,o,0,.5-n/2,o,0,.5-n/2,1-i,0,.5+n/2,1-i,0],r=new Array(s.length);for(let a=0;a<s.length/3;a++){const e=3*a;r[e+0]=(s[e+0]-.5)*t,r[e+1]=(s[e+1]-.5)*t,r[e+2]=0}return{positions:{size:3,value:new Float32Array(r)},normals:{size:3,value:new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1])},texCoords:{size:2,value:new Float32Array(s)}}}var f=i(7422);function y(e){let t=0;for(let i=0;i<e.length-1;i++)t+=e[i].distance(e[i+1]);return t}const x=[0,0,0,255],C={forward:!0,backward:!1};function v(e){let{path:t,percentage:i,lineLength:n,color:o,object:s,projectFlat:r}=e;const a=n*i;let l=0,d=0,c=0;for(c=0;c<t.length-1&&(l+=t[c].distance(t[c+1]),!(l>a));c++)d=l;c===t.length-1&&(c-=1);const p=a-d,h=t[c+1].clone().subtract(t[c]).normalize().clone().multiply(new f.I(p,p)).add(t[c]),g=180*new f.I(r(t[c+1])).subtract(r(t[c])).verticalAngle()/Math.PI;return{position:[h.x,h.y,0],angle:g,color:o,object:s}}var b=i(7597),P=i(4901);function S(e){let{p:t,p1:i,p2:n,clampToLine:o=!0}=e;const s=new b.P(n).subtract(i),r=new b.P(t).subtract(i);let a=s.dot(r);return o&&(a=(0,P.qE)(a,0,1)),s.lerp(i,n,a)}const w=r.A,k={mesh:new u({headSize:.2,tailWidth:.05})},A=Object.assign({},h.defaultProps,{MarkerLayer:w,markerLayerProps:k,sizeScale:100,fp64:!1,highlightIndex:-1,highlightPoint:null,getPath:e=>e.path,getColor:e=>e.color,getMarkerColor:e=>[0,0,0,255],getDirection:e=>e.direction,getMarkerPercentages:(e,t)=>{let{lineLength:i}=t;return i>.1?[.25,.5,.75]:[.5]}});class j extends n.A{constructor(){super(...arguments),this.state=void 0}initializeState(){this.state={markers:[],mesh:new u({headSize:.2,tailWidth:.05}),closestPoint:null,closestPoints:[]}}projectFlat(e,t,i,n){if(i===o.rf.METER_OFFSETS){const[i,o]=t.metersToLngLatDelta(e),[s,r]=n;return t.projectFlat([s+i,o+r])}if(i===o.rf.LNGLAT_OFFSETS){const[i,o]=e,[s,r]=n;return t.projectFlat([s+i,o+r])}return t.projectFlat(e)}updateState(e){let{props:t,oldProps:i,changeFlags:n}=e;if(n.dataChanged||n.updateTriggersChanged){const{data:e,getPath:t,getDirection:i,getMarkerColor:n,getMarkerPercentages:o,coordinateSystem:s,coordinateOrigin:r}=this.props,{viewport:a}=this.context,l=e=>this.projectFlat(e,a,s,r);this.state.markers=function(e){let{data:t,getPath:i=(e,t)=>e.path,getDirection:n=e=>e.direction,getColor:o=e=>x,getMarkerPercentages:s=(e,t)=>[.5],projectFlat:r}=e;const a=[];for(const l of t){const e=i(l,null),t=n(l)||C,d=o(l),c=e.map(e=>new f.I(e)),p=c.slice(0).reverse(),h=y(c),g=s(l,{lineLength:h});for(const i of g){if(t.forward){const e=v({path:c,percentage:i,lineLength:h,color:d,object:l,projectFlat:r});a.push(e)}if(t.backward){const e=v({path:p,percentage:i,lineLength:h,color:d,object:l,projectFlat:r});a.push(e)}}}return a}({data:e,getPath:t,getDirection:i,getColor:n,getMarkerPercentages:o,projectFlat:l}),this._recalculateClosestPoint()}n.propsChanged&&t.point!==i.point&&this._recalculateClosestPoint()}_recalculateClosestPoint(){const{highlightPoint:e,highlightIndex:t}=this.props;if(e&&t>=0){const i=this.props.data[t],n=this.props.getPath(i,null),{point:o}=function(e){let{p:t,points:i}=e;t=new b.P(t);let n=null,o=1/0,s=-1;for(let r=0;r<i.length-1;++r){const e=S({p:t,p1:i[r],p2:i[r+1]}),a=t.distanceSquared(e);a<o&&(o=a,n=e,s=r)}return{point:n,index:s,p1:i[s],p2:i[s+1],distanceSquared:o,distance:Math.sqrt(o)}}({points:n,p:e});this.state.closestPoints=[{position:o}]}else this.state.closestPoints=[]}getPickingInfo(e){let{info:t}=e;return Object.assign(t,{object:t.object&&t.object.path||t.object})}renderLayers(){return[new h(this.props,this.getSubLayerProps({id:"paths",data:this.props.data})),new this.props.MarkerLayer(this.getSubLayerProps(Object.assign({},this.props.markerLayerProps,{id:"markers",data:this.state.markers,getOrientation:e=>[0,-e.angle,0],getColor:e=>e.color,sizeScale:this.props.sizeScale,fp64:this.props.fp64,pickable:!1,parameters:{blend:!1,depthTest:!1}}))),this.state.closestPoints&&new s.A({id:this.props.id+"-highlight",data:this.state.closestPoints,fp64:this.props.fp64})]}}j.layerName="PathMarkerLayer",j.defaultProps=A}}]);