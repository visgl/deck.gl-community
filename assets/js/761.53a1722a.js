"use strict";(self.webpackChunkproject_website=self.webpackChunkproject_website||[]).push([[761],{21671:(e,t,o)=>{o.d(t,{U:()=>p,w:()=>m});var s=o(9350),n=o(53439);const i=Math.PI/180,a=new Float32Array(16),r=new Float32Array(12);function l(e,t,o){const s=t[0]*i,n=t[1]*i,a=t[2]*i,r=Math.sin(a),l=Math.sin(s),c=Math.sin(n),p=Math.cos(a),m=Math.cos(s),u=Math.cos(n),d=o[0],h=o[1],f=o[2];e[0]=d*u*m,e[1]=d*c*m,e[2]=d*-l,e[3]=h*(-c*p+u*l*r),e[4]=h*(u*p+c*l*r),e[5]=h*m*r,e[6]=f*(c*r+u*l*p),e[7]=f*(-u*r+c*l*p),e[8]=f*m*p}function c(e){return e[0]=e[0],e[1]=e[1],e[2]=e[2],e[3]=e[4],e[4]=e[5],e[5]=e[6],e[6]=e[8],e[7]=e[9],e[8]=e[10],e[9]=e[12],e[10]=e[13],e[11]=e[14],e.subarray(0,12)}const p={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrixCol0:{size:3,elementOffset:0},instanceModelMatrixCol1:{size:3,elementOffset:3},instanceModelMatrixCol2:{size:3,elementOffset:6},instanceTranslation:{size:3,elementOffset:9}},update(e,{startRow:t,endRow:o}){const{data:s,getOrientation:i,getScale:p,getTranslation:m,getTransformMatrix:u}=this.props,d=Array.isArray(u),h=d&&16===u.length,f=Array.isArray(p),g=Array.isArray(i),v=Array.isArray(m),M=h||!d&&Boolean(u(s[0]));e.constant=M?h:g&&f&&v;const y=e.value;if(e.constant){let t;if(M)a.set(u),t=c(a);else{t=r;l(t,i,p),t.set(m,9)}e.value=new Float32Array(t)}else{let d=t*e.size;const{iterable:x,objectInfo:C}=(0,n.X)(s,t,o);for(const e of x){let t;if(C.index++,M)a.set(h?u:u(e,C)),t=c(a);else{t=r;l(t,g?i:i(e,C),f?p:p(e,C)),t.set(v?m:m(e,C),9)}y[d++]=t[0],y[d++]=t[1],y[d++]=t[2],y[d++]=t[3],y[d++]=t[4],y[d++]=t[5],y[d++]=t[6],y[d++]=t[7],y[d++]=t[8],y[d++]=t[9],y[d++]=t[10],y[d++]=t[11]}}}};function m(e,t){return t===s.rf.CARTESIAN||t===s.rf.METER_OFFSETS||t===s.rf.DEFAULT&&!e.isGeospatial}},30048:(e,t,o)=>{o.d(t,{A:()=>s});const s="#version 300 es\n#define SHADER_NAME simple-mesh-layer-vs\nin vec3 positions;\nin vec3 normals;\nin vec3 colors;\nin vec2 texCoords;\nin vec3 instancePositions;\nin vec3 instancePositions64Low;\nin vec4 instanceColors;\nin vec3 instancePickingColors;\nin vec3 instanceModelMatrixCol0;\nin vec3 instanceModelMatrixCol1;\nin vec3 instanceModelMatrixCol2;\nin vec3 instanceTranslation;\nout vec2 vTexCoord;\nout vec3 cameraPosition;\nout vec3 normals_commonspace;\nout vec4 position_commonspace;\nout vec4 vColor;\nvoid main(void) {\ngeometry.worldPosition = instancePositions;\ngeometry.uv = texCoords;\ngeometry.pickingColor = instancePickingColors;\nvTexCoord = texCoords;\ncameraPosition = project.cameraPosition;\nvColor = vec4(colors * instanceColors.rgb, instanceColors.a);\nmat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);\nvec3 pos = (instanceModelMatrix * positions) * simpleMesh.sizeScale + instanceTranslation;\nif (simpleMesh.composeModelMatrix) {\nDECKGL_FILTER_SIZE(pos, geometry);\nnormals_commonspace = project_normal(instanceModelMatrix * normals);\ngeometry.worldPosition += pos;\ngl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), position_commonspace);\ngeometry.position = position_commonspace;\n}\nelse {\npos = project_size(pos);\nDECKGL_FILTER_SIZE(pos, geometry);\ngl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, position_commonspace);\ngeometry.position = position_commonspace;\nnormals_commonspace = project_normal(instanceModelMatrix * normals);\n}\ngeometry.normal = normals_commonspace;\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\nDECKGL_FILTER_COLOR(vColor, geometry);\n}\n"},31338:(e,t,o)=>{o.d(t,{w:()=>a});var s=o(46409),n=o(79439),i=o(38846);const a={name:"phongMaterial",dependencies:[s.x],source:n.X,vs:i.X,fs:i.l,defines:{LIGHTING_FRAGMENT:!0},uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(e){const t={...e};return t.specularColor&&(t.specularColor=t.specularColor.map(e=>e/255)),{...a.defaultUniforms,...t}}}},35983:(e,t,o)=>{function s(e){let t=1/0,o=1/0,s=1/0,n=-1/0,i=-1/0,a=-1/0;const r=e.POSITION?e.POSITION.value:[],l=r&&r.length;for(let c=0;c<l;c+=3){const e=r[c],l=r[c+1],p=r[c+2];t=e<t?e:t,o=l<o?l:o,s=p<s?p:s,n=e>n?e:n,i=l>i?l:i,a=p>a?p:a}return[[t,o,s],[n,i,a]]}o.d(t,{l:()=>s})},37963:(e,t,o)=>{o.d(t,{N:()=>n});const s="uniform simpleMeshUniforms {\n  float sizeScale;\n  bool composeModelMatrix;\n  bool hasTexture;\n  bool flatShading;\n} simpleMesh;\n",n={name:"simpleMesh",vs:s,fs:s,uniformTypes:{sizeScale:"f32",composeModelMatrix:"f32",hasTexture:"f32",flatShading:"f32"}}},38890:(e,t,o)=>{o.d(t,{A:()=>s});const s="#version 300 es\n#define SHADER_NAME simple-mesh-layer-fs\nprecision highp float;\nuniform sampler2D sampler;\nin vec2 vTexCoord;\nin vec3 cameraPosition;\nin vec3 normals_commonspace;\nin vec4 position_commonspace;\nin vec4 vColor;\nout vec4 fragColor;\nvoid main(void) {\ngeometry.uv = vTexCoord;\nvec3 normal;\nif (simpleMesh.flatShading) {\nnormal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));\n} else {\nnormal = normals_commonspace;\n}\nvec4 color = simpleMesh.hasTexture ? texture(sampler, vTexCoord) : vColor;\nDECKGL_FILTER_COLOR(color, geometry);\nvec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);\nfragColor = vec4(lightColor, color.a * layer.opacity);\n}\n"},70761:(e,t,o)=>{o.d(t,{A:()=>x});var s=o(84175),n=o(83895),i=o(67118),a=o(3459),r=o(80698),l=o(33027),c=o(25337),p=o(31338),m=o(21671),u=o(37963),d=o(30048),h=o(38890),f=o(35983);function g(e){const t=e.positions||e.POSITION;a.A.assert(t,'no "postions" or "POSITION" attribute in mesh');const o=t.value.length/t.size;let s=e.COLOR_0||e.colors;s||(s={size:3,value:new Float32Array(3*o).fill(1)});let n=e.NORMAL||e.normals;n||(n={size:3,value:new Float32Array(3*o).fill(0)});let i=e.TEXCOORD_0||e.texCoords;return i||(i={size:2,value:new Float32Array(2*o).fill(0)}),{positions:t,colors:s,normals:n,texCoords:i}}function v(e){return e instanceof c.V?(e.attributes=g(e.attributes),e):e.attributes?new c.V({...e,topology:"triangle-list",attributes:g(e.attributes)}):new c.V({topology:"triangle-list",attributes:g(e)})}const M={mesh:{type:"object",value:null,async:!0},texture:{type:"image",value:null,async:!0},sizeScale:{type:"number",value:1,min:0},_instanced:!0,wireframe:!1,material:!0,getPosition:{type:"accessor",value:e=>e.position},getColor:{type:"accessor",value:[0,0,0,255]},getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},textureParameters:{type:"object",ignore:!0,value:null}};class y extends i.A{getShaders(){return super.getShaders({vs:d.A,fs:h.A,modules:[s.A,p.w,n.A,u.N]})}getBounds(){if(this.props._instanced)return super.getBounds();let e=this.state.positionBounds;if(e)return e;const{mesh:t}=this.props;if(!t)return null;if(e=t.header?.boundingBox,!e){const{attributes:o}=v(t);o.POSITION=o.POSITION||o.positions,e=(0,f.l)(o)}return this.state.positionBounds=e,e}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{transition:!0,type:"float64",fp64:this.use64bitPositions(),size:3,accessor:"getPosition"},instanceColors:{type:"unorm8",transition:!0,size:this.props.colorFormat.length,accessor:"getColor",defaultValue:[0,0,0,255]},instanceModelMatrix:m.U}),this.setState({emptyTexture:this.context.device.createTexture({data:new Uint8Array(4),width:1,height:1})})}updateState(e){super.updateState(e);const{props:t,oldProps:o,changeFlags:s}=e;if(t.mesh!==o.mesh||s.extensionsChanged){if(this.state.positionBounds=null,this.state.model?.destroy(),t.mesh){this.state.model=this.getModel(t.mesh);const e=t.mesh.attributes||t.mesh;this.setState({hasNormals:Boolean(e.NORMAL||e.normals)})}this.getAttributeManager().invalidateAll()}t.texture!==o.texture&&t.texture instanceof r.g&&this.setTexture(t.texture),this.state.model&&this.state.model.setTopology(this.props.wireframe?"line-strip":"triangle-list")}finalizeState(e){super.finalizeState(e),this.state.emptyTexture.delete()}draw({uniforms:e}){const{model:t}=this.state;if(!t)return;const{viewport:o,renderPass:s}=this.context,{sizeScale:n,coordinateSystem:i,_instanced:a}=this.props,r={sizeScale:n,composeModelMatrix:!a||(0,m.w)(o,i),flatShading:!this.state.hasNormals};t.shaderInputs.setProps({simpleMesh:r}),t.draw(s)}get isLoaded(){return Boolean(this.state?.model&&super.isLoaded)}getModel(e){const t=new l.K(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:v(e),isInstanced:!0}),{texture:o}=this.props,{emptyTexture:s}=this.state,n={sampler:o||s,hasTexture:Boolean(o)};return t.shaderInputs.setProps({simpleMesh:n}),t}setTexture(e){const{emptyTexture:t,model:o}=this.state;if(o){const s={sampler:e||t,hasTexture:Boolean(e)};o.shaderInputs.setProps({simpleMesh:s})}}}y.defaultProps=M,y.layerName="SimpleMeshLayer";const x=y}}]);