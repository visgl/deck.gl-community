importScripts("https://cdn.jsdelivr.net/npm/gpu.js@latest/dist/gpu-browser.js"),onmessage=function(t){const{nodes:n,edges:s}=t.data,{nBodyStrength:e,nBodyDistanceMin:o,nBodyDistanceMax:i,getCollisionRadius:d}=t.data.options,c=new GPU.GPU({mode:"cpu"});function a(t,n){const s=t[1]-n[1],e=t[2]-n[2];return Math.sqrt(s*s+e*e)}function r(t,n,s){return a(t,n)<s}function u(t,n,s,e){let o=!0;for(;o;){o=!1;for(let i=0;i<s;i++)for(;t[i][0]!==n[0]&&r(n,t[i],e);){o=!0;const t=n[1]+Math.random()-.5;n[1]=n[1]+t;const s=n[2]+Math.random()-.5;n[2]=n[2]+s}}return[n[1],n[2]]}function l(t,n,s,e,o,i){let d=s[1],c=s[2];for(let a=0;a<o;a++){const o=n[a];if(o[0]===s[0]||o[1]===s[0]){const n=o[0]===s[0]?o[1]:o[0];for(let s=0;s<e;s++)if(t[a][0]===n){const n=t[s],e=d-n[1],o=c-n[2],a=1;Math.sqrt(e*e+o*o)>i+a&&(d=e>0?d-a/2:d+a/2,c=o>0?c-a/2:c+a/2)}}}return[d,c]}c.addFunction(u),c.addFunction(l),c.addFunction(r),c.addFunction(a);const g=c.createKernel(function(t,n){const s=t[this.thread.x];u(t,s,this.constants.nodesSize,this.constants.collisionRadius);const e=l(t,n,s,this.constants.nodesSize,this.constants.edgesSize,this.constants.collisionRadius);return s[1]=e[0],s[2]=e[1],[s[1],s[2]]},{constants:{nodesSize:n.length,edgesSize:s.length,collisionRadius:d,nBodyStrength:e,nBodyDistanceMin:o,nBodyDistanceMax:i},output:[n.length]}),h=n.map(t=>[t.id,t.x,t.y,t.locked?1:0]),f=s.map(t=>[t.source.id,t.target.id]);g(h,f);const p=n.map((t,n)=>{const s=h.find(n=>n[0]===t.id);return Object.assign({},t,{x:s[1],y:s[2]})}),m=s.map(t=>Object.assign({},t,{source:p.find(n=>n.id===t.source.id),target:p.find(n=>n.id===t.target.id)}));postMessage({type:"end",nodes:p,edges:m}),this.self.close()};